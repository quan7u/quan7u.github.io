

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="">
  <meta name="keywords" content="">
  
    <meta name="description" content="WebSocket å­¦ä¹ ç¬”è®°">
<meta property="og:type" content="article">
<meta property="og:title" content="WebSocketç¬”è®°">
<meta property="og:url" content="https://quan7u.github.io/note-of-websocket">
<meta property="og:site_name" content="quan7u">
<meta property="og:description" content="WebSocket å­¦ä¹ ç¬”è®°">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://quan7u.github.io/note-of-websocket/Untitled.png">
<meta property="og:image" content="https://quan7u.github.io/note-of-websocket/Untitled%201.png">
<meta property="og:image" content="https://quan7u.github.io/note-of-websocket/Untitled%202.png">
<meta property="og:image" content="https://quan7u.github.io/note-of-websocket/Untitled%203.png">
<meta property="article:published_time" content="2020-11-13T16:00:00.000Z">
<meta property="article:modified_time" content="2022-08-11T01:52:41.748Z">
<meta property="article:tag" content="websocket">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://quan7u.github.io/note-of-websocket/Untitled.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>WebSocketç¬”è®° - quan7u</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"quan7u.github.io","root":"/","version":"1.9.2","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 30vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>quan7u</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="WebSocketç¬”è®°"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2020-11-14 00:00" pubdate>
          2020å¹´11æœˆ14æ—¥ å‡Œæ™¨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          11k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          89 åˆ†é’Ÿ
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> æ¬¡
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">WebSocketç¬”è®°</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="spring-websocket-æ€»è§ˆ"><a href="#spring-websocket-æ€»è§ˆ" class="headerlink" title="spring-websocket æ€»è§ˆ"></a>spring-websocket æ€»è§ˆ</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java">â””â”€â”€ web<br>   â””â”€â”€ socket<br>      â”œâ”€â”€ adapter #é€‚é… Spring WebSocket å¯¹ Java æ ‡å‡† WebSocket API é€‚é…ï¼ˆè¿˜æœ‰ Jetty æ ‡å‡†å®ç°ï¼‰åŒ…æ‹¬æœ‰ç¼–è§£ç ã€ç›¸äº’æ‰©å±•ã€å¤„ç†å™¨ã€Session<br>      â”œâ”€â”€ client #å®¢æˆ·ç«¯  Spring å¯¹ WebSocket å®¢æˆ·ç«¯ä»¥åŠ Java æ ‡å‡† WebSocket endpoints å®ç°<br>      â”œâ”€â”€ config #å¯¹ WebSocket è¯·æ±‚å¤„ç†çš„é…ç½®ï¼ˆxml é…ç½®å’ŒåŸºäºæ³¨è§£çš„é…ç½®æ”¯æŒï¼‰<br>      â”œâ”€â”€ handler #é’ˆå¯¹ WebSocketHandler çš„å®ç°å’Œè£…é¥°<br>      â”œâ”€â”€ messaging #WebSocket é›†æˆ Spring messaging <br>      â”œâ”€â”€ server #WebSocket äº¤äº’çš„æœåŠ¡ç«¯æŠ½è±¡<br>      â”œâ”€â”€ sockjs #Top-level SockJS types.<br>      â”œâ”€â”€ AbstractWebSocketMessage.java #æŠ½è±¡æ¶ˆæ¯<br>      â”œâ”€â”€ BinaryMessage.java  #äºŒè¿›åˆ¶æ¶ˆæ¯<br>      â”œâ”€â”€ CloseStatus.java #WebSocket å…³é—­çŠ¶æ€ç å’ŒåŸå› <br>      â”œâ”€â”€ <span class="hljs-keyword">package</span>-info.java <br>      â”œâ”€â”€ PingMessage.java<br>      â”œâ”€â”€ PongMessage.java <br>      â”œâ”€â”€ SubProtocolCapable.java #WebSocket æ ‡å‡†ä¸­å®šä¹‰çš„ WebSocket å¤„ç†å™¨å­åè®®æ¥å£<br>      â”œâ”€â”€ TextMessage.java #æ–‡æœ¬æ¶ˆæ¯<br>      â”œâ”€â”€ WebSocketExtension.java #æ‰©å±•<br>      â”œâ”€â”€ WebSocketHandler.java #WebSocket æ¶ˆæ¯å’Œç”Ÿå‘½å‘¨æœŸäº‹ä»¶å¤„ç†å™¨ï¼ˆExceptionWebSocketHandlerDecorator æä¾›å¼‚å¸¸å¤„ç†ç­–ç•¥ï¼‰<br>      â”œâ”€â”€ WebSocketHttpHeaders.java #å¢åŠ äº† WebSocket è§„èŒƒçš„ http å¤´<br>      â”œâ”€â”€ WebSocketMessage.java #æ¶ˆæ¯é¡¶çº§æ¥å£<br>      â””â”€â”€ WebSocketSession.java #WebSocket session é¡¶çº§æ¥å£<br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_38345296/article/details/104040612">WebSocketå®æˆ˜è¯¦è§£ã€Springboot+Vue+sockjs+webstompã€‘_Slience Wind-CSDNåšå®¢</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u011943534/article/details/97098687">springbootå­¦ä¹ (äºŒåä¸€) springbootä¸­websocketä½¿ç”¨@MessageMappingæ¥æ”¶å„ç§ç±»å‹æ•°æ®_æ–‡è‹¥ä¹¦ç”Ÿçš„ä¸“æ -CSDNåšå®¢</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/elonpage/article/details/78446695?locationNum=5&fps=1">Spring+STOMPå®ç°WebSocketå¹¿æ’­è®¢é˜…ã€æƒé™è®¤è¯ã€ä¸€å¯¹ä¸€é€šè®¯ï¼ˆé™„æºç ï¼‰_æ°æ˜Jaminçš„åšå®¢-CSDNåšå®¢</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/web.html#websocket-stomp">Web on Servlet Stack</a></p>
<p><a target="_blank" rel="noopener" href="http://www.mydlq.club/article/86/">SpringBoot å®ç° Websocket é€šä¿¡è¯¦è§£</a></p>
<h1 id="èº«ä»½è®¤è¯åŠé‰´æƒ"><a href="#èº«ä»½è®¤è¯åŠé‰´æƒ" class="headerlink" title="èº«ä»½è®¤è¯åŠé‰´æƒ"></a>èº«ä»½è®¤è¯åŠé‰´æƒ</h1><ul>
<li>æ¡æ‰‹é‰´æƒï¼ˆé€šè¿‡ Sessionï¼‰</li>
<li>é¦–æ¬¡å‘é€æ¶ˆæ¯æ‹¦æˆªï¼ˆé€šè¿‡ WebSocket &#x2F; Stomp è¿æ¥æ–¹æ³•æºå¸¦ headerï¼‰</li>
</ul>
<p><img src="/note-of-websocket/Untitled.png" srcset="/img/loading.gif" lazyload alt="note-of-websocket%2029723de254c64768a5242417d6575173/Untitled.png"></p>
<ol>
<li>ç™»å½•ï¼ˆSessionï¼‰</li>
<li>WebSocket è¿æ¥ï¼ˆå…³è” Sessionï¼‰</li>
<li>åç»­ä¸šåŠ¡<ul>
<li>åˆ¤æ–­ç”¨æˆ·æ˜¯å¦åœ¨çº¿</li>
<li>æ¨é€</li>
</ul>
</li>
</ol>
<p>æ½œåœ¨é—®é¢˜ï¼š</p>
<ol>
<li>è¿æ¥ä¸­æ–­ï¼ˆå¿«é€Ÿçš„æ¢å¤è¿æ¥ï¼‰</li>
<li>å‘é€æ¶ˆæ¯å¤±è´¥ï¼ˆè€ƒè™‘ä¸‹æ¬¡é‡è¿å‘é€ Redisï¼‰</li>
</ol>
<h1 id="https-ä¸-wss"><a href="#https-ä¸-wss" class="headerlink" title="https ä¸ wss"></a>https ä¸ wss</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/mafly/p/websocket.html">WebSocket ç»“åˆ Nginx å®ç°åŸŸååŠ WSS åè®®è®¿é—®</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.mattermost.com/install/troubleshooting.html#failed-to-upgrade-websocket-connection">Important Notes - Mattermost 5.28 documentation</a></p>
<h1 id="4-Spring-Docï¼ˆWebSocket-éƒ¨åˆ†ï¼‰"><a href="#4-Spring-Docï¼ˆWebSocket-éƒ¨åˆ†ï¼‰" class="headerlink" title="4. Spring Docï¼ˆWebSocket éƒ¨åˆ†ï¼‰"></a>4. Spring Docï¼ˆWebSocket éƒ¨åˆ†ï¼‰</h1><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#websocket">Web on Servlet Stack</a></p>
<h2 id="4-1-ä»‹ç»"><a href="#4-1-ä»‹ç»" class="headerlink" title="4.1. ä»‹ç»"></a>4.1. ä»‹ç»</h2><p><a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc6455">RFC 6455 - The WebSocket Protocol</a></p>
<p>The WebSocket protocol, RFC 6455, provides a standardized way to establish a full-duplex, two-way communication channel between client and server over a single TCP connection.</p>
<h3 id="4-1-1-Http-VS-WebSocket"><a href="#4-1-1-Http-VS-WebSocket" class="headerlink" title="4.1.1. Http VS WebSocket"></a>4.1.1. Http VS WebSocket</h3><p>å°½ç®¡ WebSocket è¢«è®¾è®¡æˆå…¼å®¹ HTTP å¹¶å§‹äº HTTP è¯·æ±‚ï¼Œä½†è¿™ä¸¤ç§åè®®ä¼šå¯¼è‡´éå¸¸ä¸åŒçš„ä½“ç³»ç»“æ„å’Œç¼–ç¨‹æ¨¡å‹ï¼Œç†è§£è¿™ä¸€ç‚¹å¾ˆé‡è¦ã€‚</p>
<p>åœ¨ HTTP å’Œ REST ä¸­ï¼Œåº”ç”¨çš„å»ºæ¨¡åŸºäºä¼—å¤šçš„ URLã€‚å®¢æˆ·ç«¯ä»¥ã€Œè¯·æ±‚-å“åº”ã€çš„æ–¹å¼è®¿é—®é‚£äº› URLï¼Œä»è€Œä¸åº”ç”¨æœåŠ¡è¿›è¡Œäº¤äº’ã€‚æœåŠ¡ç«¯æ ¹æ® HTTP URLã€method å’Œ headers æ¥å°†è¯·æ±‚è·¯ç”±åˆ°æ­£ç¡®çš„å¤„ç†å™¨ã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œé€šå¸¸åªæœ‰ä¸€ä¸ªç”¨äºåˆå§‹åŒ–è¿æ¥çš„ URL åœ¨ WebSocket ä¸­ã€‚éšåï¼Œæ‰€æœ‰çš„åº”ç”¨æ¶ˆæ¯éƒ½åœ¨åŒä¸€ TCP è¿æ¥ä¹‹ä¸Šä¼ è¾“ã€‚è¿™å°±æŒ‡å‘äº†ä¸€ä¸ªå®Œå…¨ä¸ä¸€æ ·çš„å¼‚æ­¥çš„ã€äº‹ä»¶é©±åŠ¨çš„æ¶ˆæ¯ä¼ é€’ä½“ç³»ç»“æ„ã€‚</p>
<p>ä¸ HTTP ä¸åŒçš„æ˜¯ï¼ŒWebSocket æ˜¯ä¸€ç§ä½çº§ä¼ è¾“åè®®ã€‚å®ƒä¸è§„å®šæ¶ˆæ¯å†…å®¹çš„ä»»ä½•è¯­ä¹‰ã€‚è¿™æ„å‘³ç€ï¼Œé™¤éå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åœ¨æ¶ˆæ¯è¯­ä¹‰ä¸Šè¾¾æˆä¸€è‡´ï¼Œå¦åˆ™æ— æ³•è·¯ç”±æˆ–è€…å¤„ç†æ¶ˆæ¯ã€‚</p>
<p>é€šè¿‡ HTTP æ¡æ‰‹è¯·æ±‚çš„ <code>Sec-WebSocket-Protocol</code> è¯·æ±‚å¤´ï¼ŒWebSocket å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯ä»¥åå•†ä½¿ç”¨æ›´é«˜çº§çš„æ¶ˆæ¯ä¼ é€’åè®®ï¼ˆæ¯”å¦‚è¯´ STOMPï¼‰ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦é™å®šä»–ä»¬è‡ªå·±çš„è§„èŒƒã€‚</p>
<h3 id="4-1-2-ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨-WebSocket"><a href="#4-1-2-ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨-WebSocket" class="headerlink" title="4.1.2. ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨ WebSocket"></a>4.1.2. ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨ WebSocket</h3><p>WebSocket æ—¨åœ¨ä½¿å¾—ç½‘é¡µæ˜¯åŠ¨æ€å’Œäº¤äº’çš„ã€‚ç„¶è€Œï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒAjax &amp; HTTP å’Œé•¿è½®è¯¢å°±èƒ½å¤Ÿæä¾›ç®€å•æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œç±»ä¼¼æ–°é—»ã€é‚®ä»¶å’Œç¤¾äº¤æµéœ€è¦åŠ¨æ€æ›´æ–°ï¼Œä½†æ˜¯å‡ åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡æ˜¯å¯ä»¥è¢«æ¥å—çš„ã€‚è€Œåœ¨ååŒã€æ¸¸æˆå’Œé‡‘èåº”ç”¨ä¸­ï¼Œæ›´æ–°çš„é¢‘ç‡éœ€è¦æ¥è¿‘å®æ—¶ã€‚</p>
<p>It is the combination of low latency, high frequency, and high volume that make the best case for the use of WebSocket.</p>
<p>ä½æ—¶å»¶ï¼Œé«˜é¢‘ç‡å’Œé«˜å®¹é‡çš„ç»„åˆå³æ˜¯ä½¿ç”¨ WebSocket çš„æœ€ä½³åœºæ™¯ã€‚</p>
<p>è¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä½ æ§åˆ¶ä¹‹å¤–çš„é™åˆ¶æ€§ä»£ç†å¯èƒ½ä¼šé˜»æ­¢ WebSocket äº¤äº’ï¼Œè¦ä¹ˆå› ä¸ºä»–ä»¬æ²¡æœ‰è®¾ç½® <code>Upgrade</code>è¯·æ±‚å¤´ï¼Œè¦ä¹ˆå› ä¸ºä»–ä»¬å…³é—­é•¿æ—¶é—´ç©ºé—²çš„è¿æ¥ã€‚This means that the use of WebSocket for internal applications within the firewall is a more straightforward decision than it is for public facing applications.ï¼ˆä¸å¤ªå¥½ç¿»è¯‘ï¼Œå¤§æ¦‚å°±æ˜¯è¯´é˜²ç«å¢™å†…çš„å†…éƒ¨åº”ç”¨ä½¿ç”¨ WebSocket çš„æˆæœ¬æ›´ä½ï¼‰</p>
<h2 id="4-2-WebSocket-API"><a href="#4-2-WebSocket-API" class="headerlink" title="4.2. WebSocket API"></a>4.2. WebSocket API</h2><p>The Spring Framework provides a WebSocket API that you can use to write client- and server-side applications that handle WebSocket messages.</p>
<h3 id="4-2-1-WebSocketHandler"><a href="#4-2-1-WebSocketHandler" class="headerlink" title="4.2.1. WebSocketHandler"></a>4.2.1. WebSocketHandler</h3><p><img src="/note-of-websocket/Untitled%201.png" srcset="/img/loading.gif" lazyload alt="note-of-websocket%2029723de254c64768a5242417d6575173/Untitled%201.png"></p>
<p>Spring WebSocket æ¨¡å—ä¸åŸºäº Spring MVCã€‚é€šè¿‡ <code>WebSocketHttpRequestHandler</code> ï¼Œå°† <code>WebSocketHandler</code> é›†æˆåˆ°å…¶å®ƒ HTTP æœåŠ¡ç¯å¢ƒç›¸å¯¹ç®€å•ã€‚</p>
<p> å½“ç›´æ¥æˆ–è€…é—´æ¥ä½¿ç”¨ <code>WebSocketHandler</code> API æ—¶ï¼ˆä¾‹å¦‚é€šè¿‡ STOMP æ¶ˆæ¯ä¼ é€’ï¼‰ï¼Œåº”ç”¨å¿…é¡»åŒæ­¥å‘é€æ¶ˆæ¯ï¼Œå› ä¸ºåº•å±‚æ ‡å‡† WebSocket Sessionï¼ˆJSR-356ï¼‰ä¸å…è®¸å¹¶å‘å‘é€ã€‚ä¸€ç§å¯é€‰æ–¹æ¡ˆæ˜¯ç”¨ <code>ConcurrentWebSocketSessionDecorator</code>æ¥åŒ…è£… <code>WebSocketSession</code> ã€‚</p>
<h3 id="4-2-2-WebSocket-æ¡æ‰‹"><a href="#4-2-2-WebSocket-æ¡æ‰‹" class="headerlink" title="4.2.2. WebSocket æ¡æ‰‹"></a>4.2.2. WebSocket æ¡æ‰‹</h3><aside>
ğŸ’¡ Spring æä¾›äº† `WebSocketHandlerDecorator`  åŸºç±»æ¥ç”¨é™„åŠ è¡Œä¸ºè£…é¥° `WebSocketHandler` ã€‚
é»˜è®¤ Java é…ç½®æˆ– XML é…ç½®ä¸‹ï¼Œæ—¥å¿—å’Œå¼‚å¸¸å¤„ç†æä¾›é»˜è®¤å®ç°ã€‚
`ExceptionWebSocketHandlerDecorator` æ•è·æ¥è‡ªä»»ä½• `WebSocketHandler` æ–¹æ³•çš„æ‰€æœ‰æœªæ•è·å¼‚å¸¸ï¼Œå¹¶ä»¥çŠ¶æ€`1011` å…³é—­WebSocketä¼šè¯ï¼Œè¿™è¡¨ç¤ºä¸€ä¸ªæœåŠ¡å™¨é”™è¯¯ã€‚

</aside>

<h3 id="4-2-3-Deployment"><a href="#4-2-3-Deployment" class="headerlink" title="4.2.3. Deployment"></a>4.2.3. Deployment</h3><ul>
<li><input disabled="" type="checkbox"> TODO</li>
</ul>
<h3 id="4-2-4-Server-Configuration-æœåŠ¡ç«¯é…ç½®"><a href="#4-2-4-Server-Configuration-æœåŠ¡ç«¯é…ç½®" class="headerlink" title="4.2.4. Server Configuration æœåŠ¡ç«¯é…ç½®"></a>4.2.4. Server Configuration æœåŠ¡ç«¯é…ç½®</h3><p>æ¯ä¸ªåº•å±‚ WebSocket å¼•æ“éƒ½å¼€æ”¾äº†ä¾›æ§åˆ¶è¿è¡Œæ—¶ç‰¹æ€§çš„é…ç½®å±æ€§ï¼Œæ¯”å¦‚æ¶ˆæ¯ç¼“å†²åŒºå¤§å°ã€ç©ºé—²è¶…æ—¶æ—¶é—´ç­‰ç­‰ã€‚</p>
<p>å¯¹äº Tomcat ç­‰å®¹å™¨ï¼ˆé™¤ Jettyï¼‰ï¼Œä½ å¯ä»¥æ³¨å…¥ <code>ServletServerContainerFactoryBean</code> åˆ°ä½ çš„é…ç½®ç±»ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableWebSocket</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSocketConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebSocketConfigurer</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> ServletServerContainerFactoryBean <span class="hljs-title function_">createWebSocketContainer</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">ServletServerContainerFactoryBean</span> <span class="hljs-variable">container</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServletServerContainerFactoryBean</span>();<br>        container.setMaxTextMessageBufferSize(<span class="hljs-number">8192</span>);<br>        container.setMaxBinaryMessageBufferSize(<span class="hljs-number">8192</span>);<br>        <span class="hljs-keyword">return</span> container;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å¯¹äº Jettyï¼Œåˆ™éœ€è¦æä¾›ä¸€ä¸ªé¢„é…ç½®çš„æ¡æ‰‹å¤„ç†å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> DefaultHandshakeHandler <span class="hljs-title function_">handshakeHandler</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">WebSocketPolicy</span> <span class="hljs-variable">policy</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocketPolicy</span>(WebSocketBehavior.SERVER);<br>    policy.setInputBufferSize(<span class="hljs-number">8192</span>);<br>    policy.setIdleTimeout(<span class="hljs-number">600000</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultHandshakeHandler</span>(<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">JettyRequestUpgradeStrategy</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocketServerFactory</span>(policy)));<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4-2-5-Allowed-Origins"><a href="#4-2-5-Allowed-Origins" class="headerlink" title="4.2.5. Allowed Origins"></a>4.2.5. Allowed Origins</h3><p>é»˜è®¤åªæ”¯æŒåŒæºè¯·æ±‚ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰é…ç½®ã€‚</p>
<p>ï¼ˆNothing prevents other types of clients from modifying the Origin header valueï¼‰</p>
<p>æœ‰ 3 ç§å¯èƒ½çš„æƒ…å†µï¼š</p>
<ol>
<li><p>åªå…è®¸åŒæºè¯·æ±‚ï¼ˆé»˜è®¤é…ç½®ä¸‹ï¼‰</p>
<p> In this mode, when SockJS is enabled, the Iframe HTTP response header X-Frame-Options is set to SAMEORIGIN, and JSONP transport is disabled, since it does not allow checking the origin of a request. As a consequence, IE6 and IE7 are not supported when this mode is enabled.</p>
</li>
<li><p>æŒ‡å®šçš„ origins åˆ—è¡¨</p>
<p> Each allowed origin must start with http:&#x2F;&#x2F; or https:&#x2F;&#x2F;. In this mode, when SockJS is enabled, IFrame transport is disabled. As a consequence, IE6 through IE9 are not supported when this mode is enabled.</p>
</li>
<li><p>å…è®¸æ‰€æœ‰ originsï¼ˆè¿™ç§æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ä¼ è¾“éƒ½æœ‰æ•ˆï¼Œåº”è¯¥æ˜¯æ¨èè¿™ç§é…ç½®ï¼‰</p>
<p> To enable this mode, you should provide * as the allowed origin value. In this mode, all transports are available.</p>
</li>
</ol>
<h2 id="4-3-SockJS-Fallbackï¼ˆå›é€€ï¼‰"><a href="#4-3-SockJS-Fallbackï¼ˆå›é€€ï¼‰" class="headerlink" title="4.3. SockJS Fallbackï¼ˆå›é€€ï¼‰"></a>4.3. SockJS Fallbackï¼ˆå›é€€ï¼‰</h2><p>å…¬ç½‘ä¸Šï¼Œé™åˆ¶æ€§ä»£ç†å¯èƒ½ä¼šé˜»æ­¢ WebSocket äº¤äº’ã€‚ï¼ˆå¯èƒ½æ²¡æœ‰é…ç½® <code>Upgrade</code> å¤´å‡çº§åè®®ï¼Œå¯èƒ½é•¿æ—¶é—´ç©ºé—²è¢«å…³é—­è¿æ¥ï¼‰</p>
<p>è§£å†³ä¸Šè¿°é—®é¢˜çš„æ–¹æ¡ˆå°±æ˜¯ WebSocket æ¨¡æ‹Ÿï¼šå…ˆå°è¯•ä½¿ç”¨ WebSocketï¼Œï¼ˆä¸æˆåŠŸï¼‰å†å°è¯•ä½¿ç”¨åŸºäº HTTP çš„æŠ€æœ¯æ¥æ¨¡æ‹Ÿ WebSocket çš„äº¤äº’ï¼ŒåŒæ—¶æš´éœ²ç›¸å¯¹åº”çš„åº”ç”¨çº§åˆ«çš„ APIã€‚</p>
<h3 id="4-3-1-æ€»è§ˆ"><a href="#4-3-1-æ€»è§ˆ" class="headerlink" title="4.3.1. æ€»è§ˆ"></a>4.3.1. æ€»è§ˆ</h3><p>SockJS çš„ç›®çš„æ˜¯è®©åº”ç”¨å†è¿è¡Œæ—¶ä½¿ç”¨ WebSocket APIï¼Œå¿…è¦æ—¶é€€å›é WebSocketçš„æ¨¡å¼ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹åº”ç”¨ä»£ç ã€‚</p>
<p>æœ¬ç«  SockJS ç”±ä»¥ä¸‹ç»„æˆï¼š</p>
<ul>
<li>SockJS åè®® <a target="_blank" rel="noopener" href="https://sockjs.github.io/sockjs-protocol/sockjs-protocol-0.3.3.html">https://sockjs.github.io/sockjs-protocol/sockjs-protocol-0.3.3.html</a></li>
<li>SockJS JavaScript å®¢æˆ·ç«¯ â€”â€” æµè§ˆå™¨ç«¯çš„å®¢æˆ·ç«¯åº“</li>
<li>SockJS æœåŠ¡ç«¯å®ç°ï¼Œä¾‹å¦‚ <code>spring-websocket</code></li>
<li>SockJS Java å®¢æˆ·ç«¯ï¼ˆåŒ…å«åœ¨ <code>spring-websocket</code> )</li>
</ul>
<p>SockJS ä¸ºæµè§ˆå™¨è®¾è®¡ã€‚ä¼ è¾“å¯ä»¥åˆ†ä¸º 3 ç±»ï¼š</p>
<ol>
<li>WebSocket</li>
<li>HTTP Streamingï¼ˆæˆ‘ç†è§£ä¸º ajaxï¼Ÿ</li>
<li>HTTP Long Pollingï¼ˆé•¿è½®è¯¢</li>
</ol>
<p>å…·ä½“å‚è€ƒä¸‹æ–‡</p>
<p><a target="_blank" rel="noopener" href="https://spring.io/blog/2012/05/08/spring-mvc-3-2-preview-techniques-for-real-time-updates/">Spring MVC 3.2 Preview: Techniques for Real-time Updates</a></p>
<p>SockJS å®¢æˆ·ç«¯å‘é€ GET è¯·æ±‚ <code>/info</code> ä»æœåŠ¡ç«¯è·å–åŸºæœ¬ä¿¡æ¯ï¼Œä»è€Œå†³å®šä½¿ç”¨å“ªä¸€ç§ä¼ è¾“æ–¹å¼ã€‚</p>
<p>WebSocket â†’ HTTP streaming â†’ HTTPï¼ˆlongï¼‰polling</p>
<p>æ‰€æœ‰ä¼ è¾“è¯·æ±‚éƒ½å…·æœ‰ä»¥ä¸‹ URL ç»“æ„ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">https://host:port/myApp/myEndpoint/&#123;server-id&#125;/&#123;session-id&#125;/&#123;transport&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><code>&#123;server-id&#125;</code> å¯¹äºé›†ç¾¤ä¸­çš„è·¯ç”±è¯·æ±‚ååˆ†æœ‰ç”¨ã€‚</li>
<li><code>&#123;session-id&#125;</code>Â å°†å±äº SockJS ä¼šè¯çš„ HTTP è¯·æ±‚å…³è”èµ·æ¥ã€‚</li>
<li><code>&#123;transport&#125;</code>Â è¡¨ç¤ºä¼ è¾“æ–¹å¼ (ä¾‹å¦‚,Â <code>websocket</code>,Â <code>xhr-streaming</code> ç­‰).</li>
</ul>
<p>WebSocket ä¼ è¾“åªéœ€è¦ä¸€æ¬¡ HTTP è¯·æ±‚æ¥åš WebSocket æ¡æ‰‹ï¼Œä¹‹åæ‰€æœ‰æ¶ˆæ¯ä¼ è¾“äº¤æ¢éƒ½åœ¨è¯¥è¿æ¥ï¼ˆsocketï¼‰ä¸Šã€‚</p>
<p>SockJS adds minimal message framing.ï¼ˆæœ€å°æ¶ˆæ¯å¸§ï¼‰</p>
<p><code>o</code> open frame</p>
<p><code>h</code> heartbeat frame</p>
<p><code>c</code> close frame</p>
<h3 id="4-3-2-å¼€å¯-SockJS"><a href="#4-3-2-å¼€å¯-SockJS" class="headerlink" title="4.3.2. å¼€å¯ SockJS"></a>4.3.2. å¼€å¯ SockJS</h3><p>é€šè¿‡é…ç½®ç±»å¼€å¯ <code>withSockJS()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableWebSocket</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSocketConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebSocketConfigurer</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerWebSocketHandlers</span><span class="hljs-params">(WebSocketHandlerRegistry registry)</span> &#123;<br>        registry.addHandler(myHandler(), <span class="hljs-string">&quot;/myHandler&quot;</span>).withSockJS();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><code>sockjs-client</code> å–å†³äºæµè§ˆå™¨</p>
<p><a target="_blank" rel="noopener" href="https://github.com/sockjs/sockjs-client/">sockjs&#x2F;sockjs-client</a></p>
<h3 id="4-3-3-IE-8-and-9"><a href="#4-3-3-IE-8-and-9" class="headerlink" title="4.3.3. IE 8 and 9"></a>4.3.3. IE 8 and 9</h3><ul>
<li><input disabled="" type="checkbox"> TODO</li>
</ul>
<h3 id="4-3-4-Heartbeats"><a href="#4-3-4-Heartbeats" class="headerlink" title="4.3.4. Heartbeats"></a>4.3.4. Heartbeats</h3><p>SockJS åè®®è¦æ±‚æœåŠ¡ç«¯å‘é€å¿ƒè·³ä¿¡æ¯æ¥é˜²æ­¢ä»£ç†åˆ¤å®šè¿æ¥æŒ‚èµ·ã€‚</p>
<p>Spring SockJS é…ç½®ä¸­æœ‰ä¸€ä¸ªå« <code>heartbeatTime</code> çš„å±æ€§ï¼Œå¯ä»¥è‡ªå®šä¹‰é¢‘ç‡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœè¿æ¥ä¸Šæ²¡æœ‰å‘é€å…¶ä»–æ¶ˆæ¯ï¼Œå°†ä¼šåœ¨ 25 ç§’åå‘é€å¿ƒè·³ã€‚25 ç§’è¿™ä¸ªå€¼ç¬¦åˆ IETF çš„å»ºè®®ã€‚</p>
<p>ğŸ’¡ å½“åœ¨ WebSocket å’Œ SockJS ä¹‹ä¸Šä½¿ç”¨ STOMPæ—¶ï¼Œå¦‚æœ STOMP å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åå•†äº¤æ¢å¿ƒè·³ï¼ŒSockJS çš„å¿ƒè·³å°†è¢«ç¦ç”¨ã€‚</p>
<p>Spring SockJS æ”¯æŒè¿˜å…è®¸æ‚¨é…ç½® <code>TaskScheduler</code> æ¥è°ƒåº¦å¿ƒè·³ä»»åŠ¡ã€‚</p>
<p>ä»»åŠ¡è°ƒåº¦å™¨ç”±çº¿ç¨‹æ± æ”¯æŒï¼Œå…¶é»˜è®¤è®¾ç½®åŸºäºå¯ç”¨å¤„ç†å™¨çš„æ•°é‡ã€‚æ‚¨åº”è¯¥è€ƒè™‘æ ¹æ®æ‚¨çš„å…·ä½“éœ€è¦è‡ªå®šä¹‰è®¾ç½®ã€‚</p>
<h3 id="4-3-5-Client-Disconnects"><a href="#4-3-5-Client-Disconnects" class="headerlink" title="4.3.5. Client Disconnects"></a>4.3.5. Client Disconnects</h3><p>åœ¨ Servlet å®¹å™¨ä¸­ï¼Œè¿™æ˜¯é€šè¿‡ Servlet 3 å¼‚æ­¥æ”¯æŒå®Œæˆçš„ï¼Œè¯¥æ”¯æŒå…è®¸é€€å‡ºServletå®¹å™¨çº¿ç¨‹ï¼Œå¤„ç†è¯·æ±‚ï¼Œå¹¶ç»§ç»­å†™å…¥æ¥è‡ªå¦ä¸€ä¸ªçº¿ç¨‹çš„å“åº”ã€‚</p>
<p>ä¸€ä¸ªç‰¹å®šå¸¸è§çš„é—®é¢˜æ˜¯ï¼ŒServlet API ä¸ä¼šé€šçŸ¥å®¢æˆ·ç«¯æ–­å¼€äº†è¿æ¥ã€‚ä½†æ˜¯ï¼ŒServlet å®¹å™¨ä¼šåœ¨æ–­å¼€åå†™ response æ—¶å‘ç”Ÿå¼‚å¸¸ã€‚ç”±äº Spring s SockJS æœåŠ¡æ”¯æŒæœåŠ¡å™¨å‘é€å¿ƒè·³ï¼ˆé»˜è®¤ä¸ºæ¯ 25 ç§’ï¼‰ï¼Œè¿™æ„å‘³ç€å®¢æˆ·ç«¯æ–­å¼€è¿æ¥é€šå¸¸åœ¨è¯¥æ—¶é—´æ®µå†…è¢«æ£€æµ‹åˆ°ï¼ˆæˆ–è€…æ›´æ—©ï¼Œå¦‚æœæ¶ˆæ¯å‘é€æ›´é¢‘ç¹çš„è¯ï¼‰ã€‚</p>
<p>ğŸ’¡ å› æ­¤ï¼Œç½‘ç»œ I&#x2F;O å¯èƒ½ä¼šå› ä¸ºå®¢æˆ·ç«¯æ–­å¼€è¿æ¥è€Œå‘ç”Ÿé”™è¯¯ï¼ŒæŠŠæ— ç”¨çš„ stack traces å†™å…¥æ—¥å¿—ã€‚Spring å°½æœ€å¤§åŠªåŠ›è¯†åˆ«è¡¨ç¤ºå®¢æˆ·ç«¯æ–­å¼€è¿æ¥ï¼ˆç‰¹å®šäºæ¯ä¸ªæœåŠ¡å™¨ï¼‰çš„ç½‘ç»œæ•…éšœï¼Œå¹¶é€šè¿‡ä½¿ç”¨ä¸“ç”¨çš„æ—¥å¿—ç±»åˆ«â€”â€”æ–­å¼€è¿æ¥çš„å®¢æˆ·ç«¯æ—¥å¿—ç±»åˆ«ï¼ˆåœ¨ AbstractSockJsSession ä¸­å®šä¹‰ï¼‰è®°å½•æœ€å°çš„æ¶ˆæ¯ä½œä¸ºæ—¥å¿—ã€‚If you need to see the stack traces, you can set that log category to TRACE.</p>
<h3 id="4-3-6-SockJS-and-CORSï¼ˆè·¨åŸŸï¼‰"><a href="#4-3-6-SockJS-and-CORSï¼ˆè·¨åŸŸï¼‰" class="headerlink" title="4.3.6. SockJS and CORSï¼ˆè·¨åŸŸï¼‰"></a>4.3.6. SockJS and CORSï¼ˆè·¨åŸŸï¼‰</h3><ul>
<li><input disabled="" type="checkbox"> TODO</li>
</ul>
<h3 id="4-3-7-SockJSClient"><a href="#4-3-7-SockJSClient" class="headerlink" title="4.3.7. SockJSClient"></a>4.3.7. SockJSClient</h3><p>Spring æä¾›äº†ä¸€ä¸ª SockJS Java å®¢æˆ·ç«¯æ¥è¿æ¥è¿œç¨‹çš„ SockJS ç«¯ç‚¹ï¼Œä»è€Œä¸éœ€è¦ä½¿ç”¨æµè§ˆå™¨ã€‚å½“éœ€è¦åœ¨å…¬å…±ç½‘ç»œä¸Šï¼ˆç½‘ç»œä»£ç†å¯èƒ½é˜»æ­¢ WebSocket åè®®ï¼‰çš„ä¸¤å°æœåŠ¡å™¨ä¹‹é—´è¿›è¡ŒåŒå‘é€šä¿¡æ—¶ï¼Œè¿™å°¤å…¶æœ‰ç”¨ã€‚SockJS çš„ Java å®¢æˆ·ç«¯ä¹Ÿéå¸¸é€‚ç”¨äºæµ‹è¯•åœºæ™¯ï¼ˆä¾‹å¦‚ï¼Œæ¨¡æ‹Ÿå¤§é‡å¹¶å‘ç”¨æˆ·ï¼‰ã€‚</p>
<ul>
<li><input disabled="" type="checkbox"> TODO</li>
</ul>
<h2 id="4-4-STOMP"><a href="#4-4-STOMP" class="headerlink" title="4.4. STOMP"></a>4.4. STOMP</h2><p>WebSocket åè®®å®šä¹‰ä¸¤ç§ç±»å‹çš„æ¶ˆæ¯ï¼ˆæ–‡æœ¬å’ŒäºŒè¿›åˆ¶ï¼‰ï¼Œä½†å†…å®¹æ²¡æœ‰è§„èŒƒå®šä¹‰ã€‚</p>
<p>ä½¿ç”¨ STOMP å­åè®®æ˜¯å¯é€‰æ“ä½œï¼Œå› ä¸ºæ— è®ºé‡‡ç”¨å“ªç§æ–¹å¼ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½éœ€è¦è¾¾æˆä¸€è‡´ã€‚</p>
<h3 id="4-4-1-æ€»è§ˆ"><a href="#4-4-1-æ€»è§ˆ" class="headerlink" title="4.4.1. æ€»è§ˆ"></a>4.4.1. æ€»è§ˆ</h3><p>STOMPï¼ˆSimple Text Oriented Protocol ç®€å•çš„é¢å‘æ–‡æœ¬çš„æ¶ˆæ¯ä¼ é€’åè®®ï¼‰æœ€åˆæ˜¯ä¸ºè„šæœ¬è¯­è¨€åˆ›å»ºï¼Œç”¨äºè¿æ¥åˆ°ä¼ä¸šæ¶ˆæ¯ä»£ç†ã€‚STOMPå¯ä»¥ç”¨äºä»»ä½•å¯é çš„åŒå‘æµåª’ä½“ç½‘ç»œåè®®ï¼Œå¦‚TCPå’ŒWebSocketã€‚å°½ç®¡è¯´ STOMP æ˜¯é¢å‘æ–‡æœ¬çš„åè®®ï¼Œä½†æ¶ˆæ¯è´Ÿè½½ä»ç„¶æ—¢å¯ä»¥ä¸ºæ–‡æœ¬æˆ–è€…æ˜¯äºŒè¿›åˆ¶ã€‚</p>
<p>STOMP æ˜¯åŸºäº HTTP çš„ä¸€ç§åŸºäºæ¡†æ¶çš„åè®®ï¼Œä¸‹é¢æ˜¯ STOMP æ¡†æ¶çš„ç»“æ„ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html">COMMAND<br>header1:value1<br>header2:value2<br><br>Body^@<br></code></pre></td></tr></table></figure>

<p>å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨ <code>SEND</code> æˆ– <code>SUBSCRIBE</code> å‘½ä»¤å‘é€æˆ–è®¢é˜…æ¶ˆæ¯ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ <code>destination</code> æ ‡å¤´æ¥æè¿°æ¶ˆæ¯çš„å†…å®¹ä»¥åŠè°åº”è¯¥æ¥æ”¶æ¶ˆæ¯ã€‚è¿™æ”¯æŒä¸€ç§ç®€å•çš„å‘å¸ƒ-è®¢é˜…æœºåˆ¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¯¥æœºåˆ¶é€šè¿‡ä»£ç†å°†æ¶ˆæ¯å‘é€åˆ°å…¶ä»–è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œæˆ–å°†æ¶ˆæ¯å‘é€åˆ°æœåŠ¡å™¨ä»¥è¯·æ±‚æ‰§è¡ŒæŸäº›å·¥ä½œã€‚</p>
<p>å½“ä½ ä½¿ç”¨ Spring çš„ STOMP æ”¯æ’‘æ¨¡å—æ—¶ï¼ŒSpring WebSocket åº”ç”¨å……å½“å®¢æˆ·ç«¯çš„ STOMP ä»£ç†ã€‚æ¶ˆæ¯è¢«è·¯ç”±åˆ° <code>@Controller</code> æ¶ˆæ¯å¤„ç†æ–¹æ³•æˆ–æ˜¯ç®€å•çš„å†…å­˜ä»£ç†ï¼Œè¯¥ä»£ç†èƒ½å¤Ÿè¿½è¸ªè®¢é˜…ä»¥åŠå‘è®¢é˜…ç”¨æˆ·å¹¿æ’­æ¶ˆæ¯ã€‚</p>
<p>Spring ä¹Ÿæ”¯æŒé…ç½®ä¸“ç”¨çš„ STOMP ä»£ç†ï¼ˆå¦‚ RabbitMQã€ActiveMQç­‰ç­‰ï¼‰æ¥è¿›è¡Œæ¶ˆæ¯å¹¿æ’­ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒSpring ç»´æŠ¤åˆ°ä»£ç†çš„ TCP è¿æ¥ï¼Œå°†æ¶ˆæ¯è½¬å‘ç»™ä»£ç†ï¼Œå¹¶å°†æ¶ˆæ¯ä»ä»£ç†å‘ä¸‹ä¼ é€’åˆ°è¿æ¥çš„ WebSocket å®¢æˆ·ç«¯ã€‚</p>
<p>å› æ­¤ï¼ŒSpring Web åº”ç”¨å¯ä»¥ä¾èµ–ç»Ÿä¸€çš„åŸºäº HTTP å®‰å…¨ï¼Œå…¬å…±æ ¡éªŒï¼Œä»¥åŠç†Ÿæ‚‰çš„ç¼–ç¨‹æ¨¡å‹æ¥å¤„ç†æ¶ˆæ¯ã€‚</p>
<p>è®¢é˜…ç¤ºä¾‹</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html">SUBSCRIBE<br>id:sub-1<br>destination:/topic/price.stock.*<br><br>^@<br></code></pre></td></tr></table></figure>

<p>å®¢æˆ·ç«¯å‘é€ç¤ºä¾‹</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs html">SEND<br>destination:/queue/trade<br>content-type:application/json<br>content-length:44<br><br>&#123;&quot;action&quot;:&quot;BUY&quot;,&quot;ticker&quot;:&quot;MMM&quot;,&quot;shares&quot;,44&#125;^@<br></code></pre></td></tr></table></figure>

<p>æœåŠ¡ç«¯å¹¿æ’­æ¶ˆæ¯ç»™è®¢é˜…è€…</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs html">MESSAGE<br>message-id:nxahklf6-1<br>subscription:sub-1<br>destination:/topic/price.stock.MMM<br><br>&#123;&quot;ticker&quot;:&quot;MMM&quot;,&quot;price&quot;:129.45&#125;^@<br></code></pre></td></tr></table></figure>

<ul>
<li><input disabled="" type="checkbox"> TODO</li>
</ul>
<h3 id="4-4-2-å¥½å¤„"><a href="#4-4-2-å¥½å¤„" class="headerlink" title="4.4.2. å¥½å¤„"></a>4.4.2. å¥½å¤„</h3><ul>
<li><input disabled="" type="checkbox"> TODO</li>
</ul>
<h3 id="4-4-3-å¼€å¯-STOMP"><a href="#4-4-3-å¼€å¯-STOMP" class="headerlink" title="4.4.3. å¼€å¯ STOMP"></a>4.4.3. å¼€å¯ STOMP</h3><p>åœ¨ <code>spring-messaging</code> å’Œ <code>spring-websocket</code> æ¨¡å—ä¸­æä¾›äº†å¯¹WebSocketçš„æ”¯æŒã€‚</p>
<p>é…ç½®ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.web.socket.config.annotation.EnableWebSocketMessageBroker;<br><span class="hljs-keyword">import</span> org.springframework.web.socket.config.annotation.StompEndpointRegistry;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableWebSocketMessageBroker</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSocketConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebSocketMessageBrokerConfigurer</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerStompEndpoints</span><span class="hljs-params">(StompEndpointRegistry registry)</span> &#123;<br>				<span class="hljs-comment">// 1.å£°æ˜ WebSocket/SockJS å®¢æˆ·ç«¯æ¡æ‰‹è¿æ¥çš„ HTTP URL</span><br>        registry.addEndpoint(<span class="hljs-string">&quot;/portfolio&quot;</span>).withSockJS();  <br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configureMessageBroker</span><span class="hljs-params">(MessageBrokerRegistry config)</span> &#123;<br>				<span class="hljs-comment">// 2.destination å¤´ä»¥ /app ä¸ºå‰ç¼€çš„ STOMP æ¶ˆæ¯å°†è·¯ç”±åˆ° @Controller ç±»ä¸­çš„ @MessageMapping æ–¹æ³•</span><br>        config.setApplicationDestinationPrefixes(<span class="hljs-string">&quot;/app&quot;</span>); <br>				<span class="hljs-comment">// 3.å¯¹äºè®¢é˜…å’Œå¹¿æ’­ä½¿ç”¨å†…ç½®ç®€å•æ¶ˆæ¯ä»£ç†ï¼Œè·¯ç”±destination å¤´ä»¥ /topic å’Œ /queue ä¸ºå‰ç¼€çš„æ¶ˆæ¯åˆ°ä»£ç†</span><br>        config.enableSimpleBroker(<span class="hljs-string">&quot;/topic&quot;</span>, <span class="hljs-string">&quot;/queue&quot;</span>); <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ğŸ’¡ å¯¹äºå†…ç½®ç®€å•ä»£ç†ï¼Œ<code>/topic</code> å’Œ <code>/queue</code> å¹¶æ²¡æœ‰ä»»ä½•ç‰¹æ®Šå«ä¹‰ã€‚ä»–ä»¬åªæ˜¯ç”¨æ¥åŒºåˆ†å‘å¸ƒ-è®¢é˜…å’Œç‚¹å¯¹ç‚¹æ¶ˆæ¯ä¼ é€’çš„ä¸€ç§çº¦å®šã€‚å½“ä½¿ç”¨å¤–éƒ¨ä»£ç†æ—¶ï¼Œè¯·æ£€æŸ¥ä»£ç†çš„ STOMP é¡µé¢ï¼Œäº†è§£å®ƒæ”¯æŒå“ªç§å‰ç¼€ã€‚</p>
<p>å…³äº STOMPï¼Œå¯ä»¥é€‰æ‹©çš„å®¢æˆ·ç«¯åº“æœ‰</p>
<p><strong>é¡¹ç›®ä¸­ç”¨åˆ°ä¸‹é¢è¿™ä¸ª</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/jmesnil/stomp-websocket">jmesnil&#x2F;stomp-websocket</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/JSteunou/webstomp-client">webstomp-client</a></p>
<h3 id="4-4-4-WebSocket-Server-æœåŠ¡ç«¯é…ç½®"><a href="#4-4-4-WebSocket-Server-æœåŠ¡ç«¯é…ç½®" class="headerlink" title="4.4.4. WebSocket Server æœåŠ¡ç«¯é…ç½®"></a>4.4.4. WebSocket Server æœåŠ¡ç«¯é…ç½®</h3><p>åœ¨ä¸Šé¢çš„ <code>å¼€å¯ STOMP</code> éƒ¨åˆ†å·²ç»æåˆ°ï¼Œä¸å†é‡å¤ã€‚</p>
<h3 id="4-4-5-Flow-of-Messages-æ¶ˆæ¯æµ"><a href="#4-4-5-Flow-of-Messages-æ¶ˆæ¯æµ" class="headerlink" title="4.4.5. Flow of Messages æ¶ˆæ¯æµ"></a>4.4.5. Flow of Messages æ¶ˆæ¯æµ</h3><p>ä¸€æ—¦ STOMP ç«¯ç‚¹æš´éœ²å‡ºæ¥ï¼ŒSpringåº”ç”¨å°±æˆä¸ºå®¢æˆ·ç«¯è¿æ¥çš„ STOMP ä»£ç†æœåŠ¡ã€‚</p>
<p><code>spring-messaging</code> çš„ä¸€äº›æŠ½è±¡ç»„ä»¶å¦‚ä¸‹ï¼š</p>
<ul>
<li>Messageï¼šç®€å•çš„æ¶ˆæ¯ï¼ŒåŒ…æ‹¬ header å’Œ payloadã€‚</li>
<li>MessageHandlerï¼šç”¨äºå¤„ç†æ¶ˆæ¯</li>
<li>MessageChannelï¼šç”¨äºè§£æ„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å‘é€æ¶ˆæ¯è¿™ä¸€è¿‡ç¨‹</li>
<li>SubscribeChannelï¼šMessageChannel with MessageHandler subscribers.</li>
<li>ExecutorSubscribableChannelï¼šSubscribableChannel that uses an Executor for delivering messages.</li>
</ul>
<p>ä½¿ç”¨ Java é…ç½®ç±»ï¼ˆ@EnableWebSocketMessageBrokerï¼‰æˆ–æ˜¯ XML é…ç½®ï¼ˆ<a href="websocket:message-broker">websocket:message-broker</a>ï¼‰éƒ½ä½¿ç”¨ä¸Šé¢çš„ç»„ä»¶æ¥ç»„è£…æ¶ˆæ¯å·¥ä½œæµã€‚</p>
<p>ä¸‹å›¾å±•ç¤ºäº†å¯ç”¨å†…ç½®æ¶ˆæ¯ä»£ç†æ—¶ç”¨åˆ°çš„ç»„ä»¶ï¼š</p>
<p><img src="/note-of-websocket/Untitled%202.png" srcset="/img/loading.gif" lazyload alt="note-of-websocket%2029723de254c64768a5242417d6575173/Untitled%202.png"></p>
<p>ä¸Šå›¾å±•ç¤ºäº† 3 ä¸ªæ¶ˆæ¯é¢‘é“ï¼š</p>
<ul>
<li><code>clientInboundChannel</code>: For passing messages received from WebSocket clients.</li>
<li><code>clientOutboundChannel</code>: For sending server messages to WebSocket clients.</li>
<li><code>brokerChannel</code>: For sending messages to the message broker from within server-side application code.</li>
</ul>
<p>ä¸‹å›¾å±•ç¤ºäº†é…ç½®å¤–éƒ¨ä»£ç†ï¼ˆå¦‚ RabbitMQï¼‰æ¥ç®¡ç†è®¢é˜…å’Œå¹¿æ’­æ¶ˆæ¯æ—¶ä½¿ç”¨çš„ç»„ä»¶ï¼š</p>
<p><img src="/note-of-websocket/Untitled%203.png" srcset="/img/loading.gif" lazyload alt="note-of-websocket%2029723de254c64768a5242417d6575173/Untitled%203.png"></p>
<p>ä»¥ä¸Šæœ€ä¸»è¦åŒºåˆ«æ˜¯ä½¿ç”¨äº† <code>broker relay</code> æ¥é€šè¿‡ TCP å°†æ¶ˆæ¯å‘ä¸Šä¼ é€’åˆ°å¤–éƒ¨ STOMP ä»£ç†ï¼Œä»¥åŠå°†æ¶ˆæ¯ä»ä»£ç†å‘ä¸‹ä¼ é€’åˆ°è®¢é˜…çš„å®¢æˆ·ç«¯ã€‚</p>
<p>WebSocket è¿æ¥å‘é€çš„æ¶ˆæ¯ï¼Œä¼šè¢«è§£ç æˆ STOMP å¸§ï¼Œè½¬åŒ–æˆ Spring <code>Message</code>  è¡¨ç¤ºï¼Œå¹¶è¢«å‘é€åˆ° <code>clientInboundChannel</code> åšè¿›ä¸€æ­¥å¤„ç†ã€‚æ¯”å¦‚ï¼Œä»¥ <code>/app</code> å¼€å¤´çš„æ¶ˆæ¯ä¼šè¢«è·¯ç”±åˆ° controller æ³¨è§£ç±»ä¸­çš„ <code>@MessageMapping</code> æ–¹æ³•ï¼Œä»¥ <code>/topic</code> å’Œ <code>/queue</code> å¼€å¤´çš„æ¶ˆæ¯ä¼šè¢«ç›´æ¥è·¯ç”±åˆ°æ¶ˆæ¯ä»£ç†ã€‚</p>
<p>An annotated @Controller that handles a STOMP message from a client may send a message to the message broker through the brokerChannel, and the broker broadcasts the message to matching subscribers through the clientOutboundChannel. The same controller can also do the same in response to HTTP requests, so a client can perform an HTTP POST, and then a @PostMapping method can send a message to the message broker to broadcast to subscribed clients.</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%88%86%E7%B1%BB/" class="category-chain-item">åˆ†ç±»</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/websocket/">#websocket</a>
      
    </div>
  
</div>


              

              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/note-of-hystrix" title="Hystrix ç¬”è®°">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Hystrix ç¬”è®°</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/note-of-spring-security" title="Spring Security ç¬”è®°">
                        <span class="hidden-mobile">Spring Security ç¬”è®°</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'quan7u/quan7u.github.io');
      s.setAttribute('issue-term', 'url');
      
      s.setAttribute('label', 'utterances');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        æ€»è®¿é—®é‡ 
        <span id="busuanzi_value_site_pv"></span>
         æ¬¡
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        æ€»è®¿å®¢æ•° 
        <span id="busuanzi_value_site_uv"></span>
         äºº
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
