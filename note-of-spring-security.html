

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="">
  <meta name="keywords" content="">
  
    <meta name="description" content="Spring Security å®˜æ–¹æ–‡æ¡£å­¦ä¹ ç¬”è®°">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring Security ç¬”è®°">
<meta property="og:url" content="https://quan7u.github.io/note-of-spring-security">
<meta property="og:site_name" content="quan7u">
<meta property="og:description" content="Spring Security å®˜æ–¹æ–‡æ¡£å­¦ä¹ ç¬”è®°">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://quan7u.github.io/note-of-spring-security/Untitled.png">
<meta property="og:image" content="https://quan7u.github.io/note-of-spring-security/Untitled%201.png">
<meta property="og:image" content="https://quan7u.github.io/note-of-spring-security/Untitled%202.png">
<meta property="og:image" content="https://quan7u.github.io/note-of-spring-security/Untitled%203.png">
<meta property="og:image" content="https://quan7u.github.io/note-of-spring-security/Untitled%204.png">
<meta property="og:image" content="https://quan7u.github.io/note-of-spring-security/Untitled%205.png">
<meta property="og:image" content="https://quan7u.github.io/note-of-spring-security/Untitled%206.png">
<meta property="og:image" content="https://quan7u.github.io/note-of-spring-security/Untitled%207.png">
<meta property="og:image" content="https://quan7u.github.io/note-of-spring-security/Untitled%208.png">
<meta property="og:image" content="https://quan7u.github.io/note-of-spring-security/Untitled%209.png">
<meta property="og:image" content="https://quan7u.github.io/note-of-spring-security/Untitled%2010.png">
<meta property="og:image" content="https://quan7u.github.io/note-of-spring-security/Untitled%2011.png">
<meta property="og:image" content="https://quan7u.github.io/note-of-spring-security/Untitled%2012.png">
<meta property="article:published_time" content="2020-10-13T16:00:00.000Z">
<meta property="article:modified_time" content="2022-08-11T01:52:46.533Z">
<meta property="article:tag" content="Spring">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://quan7u.github.io/note-of-spring-security/Untitled.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>Spring Security ç¬”è®° - quan7u</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"quan7u.github.io","root":"/","version":"1.9.2","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 30vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>quan7u</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Spring Security ç¬”è®°"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2020-10-14 00:00" pubdate>
          2020å¹´10æœˆ14æ—¥ å‡Œæ™¨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          12k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          101 åˆ†é’Ÿ
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> æ¬¡
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Spring Security ç¬”è®°</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="docs-spring-io-x2F-spring-security"><a href="#docs-spring-io-x2F-spring-security" class="headerlink" title="docs.spring.io&#x2F;spring-security"></a>docs.spring.io&#x2F;spring-security</h1><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/5.3.5.RELEASE/reference/html5/#servlet-authentication-mechanisms">Spring Security Reference</a></p>
<h1 id="9-Servlet-Securityï¼šThe-Big-Picture"><a href="#9-Servlet-Securityï¼šThe-Big-Picture" class="headerlink" title="9. Servlet Securityï¼šThe Big Picture"></a>9. Servlet Securityï¼šThe Big Picture</h1><h2 id="9-1-A-Review-of-Filter-s"><a href="#9-1-A-Review-of-Filter-s" class="headerlink" title="9.1. A Review of Filter s"></a>9.1. A Review of <code>Filter</code> s</h2><p><img src="/note-of-spring-security/Untitled.png" srcset="/img/loading.gif" lazyload alt="/../image/note-of-spring-security/Untitled.png"></p>
<h2 id="9-2-DelegatingFilterProxy"><a href="#9-2-DelegatingFilterProxy" class="headerlink" title="9.2. DelegatingFilterProxy"></a>9.2. DelegatingFilterProxy</h2><p>Spring æä¾›äº†ä¸€ä¸ªåä¸º <code>DelegatingFilterProxy</code> çš„ <code>Filter</code> å®ç°ï¼Œå®ƒå…è®¸åœ¨ Servlet å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå’Œ Spring çš„ <code>ApplicationContext</code> ä¹‹é—´å»ºç«‹æ¡¥æ¥ã€‚</p>
<p><img src="/note-of-spring-security/Untitled%201.png" srcset="/img/loading.gif" lazyload alt="/../image/note-of-spring-security/Untitled%201.png"></p>
<p><code>DelegatingFilterProxy</code> ä» <code>ApplicationContext</code> æŸ¥æ‰¾ Bean Filter0ï¼Œç„¶åè°ƒç”¨Bean Filter0ã€‚</p>
<p><strong>DelegatingFilterProxy ä¼ªä»£ç </strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> &#123;<br>    <span class="hljs-comment">// Lazily get Filter that was registered as a Spring Bean</span><br>    <span class="hljs-comment">// For the example in DelegatingFilterProxy delegate is an instance of Bean Filter0</span><br>    <span class="hljs-type">Filter</span> <span class="hljs-variable">delegate</span> <span class="hljs-operator">=</span> getFilterBean(someBeanName);<br>    <span class="hljs-comment">// delegate work to the Spring Bean</span><br>    delegate.doFilter(request, response);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><code>DelegatingFilterProxy</code> çš„å¦å¤–ä¸€ä¸ªå¥½å¤„æ˜¯å¯ä»¥å»¶è¿ŸæŸ¥æ‰¾ <code>Filter</code> Bean å®ä¾‹ã€‚è¿™å¾ˆé‡è¦ï¼Œå› ä¸ºå®¹å™¨éœ€è¦åœ¨å¯åŠ¨ä¹‹å‰æ³¨å†Œ <code>Filter</code> å®ä¾‹ã€‚ä½†æ˜¯ï¼ŒSpringé€šå¸¸ä½¿ç”¨ <code>ContextLoaderListener</code> æ¥åŠ è½½Spring Beansï¼Œè¿™åœ¨éœ€è¦æ³¨å†Œçš„ <code>Filter</code> å®ä¾‹æ³¨å†Œä¹‹å‰æ˜¯ä¸ä¼šå®Œæˆçš„ã€‚</p>
<h2 id="9-3-FilterChainProxy"><a href="#9-3-FilterChainProxy" class="headerlink" title="9.3. FilterChainProxy"></a>9.3. FilterChainProxy</h2><p>Spring Security çš„ Servlet æ”¯æŒåŒ…å«åœ¨ <code>FilterChainProxy</code> ä¸­ã€‚<code>FilterChainProxy</code> æ˜¯ Spring Security æä¾›çš„ä¸€ä¸ªç‰¹æ®Šçš„ <code>Filter</code> ï¼Œå…è®¸é€šè¿‡  <code>SecurityFilterChain</code> ä»£ç†ç»™å¤šä¸ª Filter å®ä¾‹å·¥ä½œã€‚å®ƒé€šå¸¸è¢«å°è£…åœ¨ DelegatingFilterProxy ä¸­ã€‚</p>
<p><img src="/note-of-spring-security/Untitled%202.png" srcset="/img/loading.gif" lazyload alt="/../image/note-of-spring-security/Untitled%202.png"></p>
<h2 id="9-4-SecurityFilterChain"><a href="#9-4-SecurityFilterChain" class="headerlink" title="9.4. SecurityFilterChain"></a>9.4. SecurityFilterChain</h2><p><code>SecurityFilterChain</code> è¢« FilterChainProxy ç”¨æ¥ç¡®å®šæœ¬æ¬¡è¯·æ±‚åº”è¯¥è°ƒç”¨å“ªäº› Spring Securityçš„ <code>Filter</code> sã€‚</p>
<p><img src="/note-of-spring-security/Untitled%203.png" srcset="/img/loading.gif" lazyload alt="/../image/note-of-spring-security/Untitled%203.png"></p>
<p><img src="/note-of-spring-security/Untitled%204.png" srcset="/img/loading.gif" lazyload alt="/../image/note-of-spring-security/Untitled%204.png"></p>
<h2 id="9-5-Security-Filters-è¿‡æ»¤å™¨"><a href="#9-5-Security-Filters-è¿‡æ»¤å™¨" class="headerlink" title="9.5. Security Filters è¿‡æ»¤å™¨"></a>9.5. Security Filters è¿‡æ»¤å™¨</h2><p>æœ‰æ—¶å€™çŸ¥é“ Security Filters é¡ºåºæ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p>
<ul>
<li>Spring Security Filter çš„æ’åº<ul>
<li><p>ChannelProcessingFilter</p>
</li>
<li><p>ConcurrentSessionFilter</p>
</li>
<li><p>WebAsyncManagerIntegrationFilter</p>
  <aside>
  ğŸ’¡ ä¸ºåç»­çš„å¼‚æ­¥è°ƒç”¨å‡†å¤‡ WebAsyncManager
  
  </aside>
  </li>
<li><p>SecurityContextPersistenceFilter</p>
  <aside>
  ğŸ’¡ è¯·æ±‚æ¥ä¸´æ—¶ï¼Œåˆ›å»ºä¸€ä¸ª SecurityContextHolderï¼Œæœ¬è´¨ä¸Šæ˜¯ ThreadLocalï¼›
  è¯·æ±‚å¤„ç†å®Œæˆæ—¶ï¼Œæ¸…é™¤ SecurityContextHolderã€‚
  è§£å†³åœ¨è¯·æ±‚å½“å‰çº¿ç¨‹ä¸­çš„ç”¨æˆ·ä¿¡æ¯è·å–ã€‚
  
  </aside>
  </li>
<li><p>HeaderWriterFilter</p>
  <aside>
  ğŸ’¡ æ·»åŠ æŸäº› header å¯ç”¨æµè§ˆå™¨ä¿æŠ¤çš„åœºæ™¯å¾ˆæœ‰ç”¨ã€‚
  æ¯”å¦‚X-Frame-Options, X-XSS-Protectionå’ŒX-Content-Type-Optionsã€‚
  
  </aside>
  </li>
<li><p>CorsFilter</p>
  <aside>
  ğŸ’¡ è·¨åŸŸå¤„ç†ï¼Œæœ‰é»˜è®¤å®ç°ã€‚
  
  </aside>
  </li>
<li><p>CsrfFilter</p>
  <aside>
  ğŸ’¡ csrf token ç›¸å…³
  
  </aside>
  </li>
<li><p>LogoutFilter ç™»å‡ºè¿‡æ»¤å™¨</p>
<p>  <img src="/note-of-spring-security/Untitled%205.png" srcset="/img/loading.gif" lazyload alt="/../image/note-of-spring-security/Untitled%205.png"></p>
<p>  é»˜è®¤æƒ…å†µä¸‹åŒ¹é… <code>/logout</code> ï¼Œ2 ä¸ª LogoutHandler</p>
<ol>
<li>SecurityContextLogoutHandler<ul>
<li>invalidateHttpSession &#x2F;&#x2F; æ¸…é™¤ Session</li>
<li>clearAuthentication &#x2F;&#x2F; æ¸…é™¤è®¤è¯</li>
</ul>
</li>
<li>LogoutSuccessEventPublishingLogoutHandler äº‹ä»¶é€šçŸ¥</li>
</ol>
</li>
<li><p>OAuth2AuthorizationRequestRedirectFilter</p>
</li>
<li><p>Saml2WebSsoAuthenticationRequestFilter</p>
</li>
<li><p>X509AuthenticationFilter</p>
</li>
<li><p>AbstractPreAuthenticatedProcessingFilter</p>
</li>
<li><p>CasAuthenticationFilter</p>
</li>
<li><p>OAuth2LoginAuthenticationFilter</p>
</li>
<li><p>Saml2WebSsoAuthenticationFilter</p>
</li>
<li><p><code>[UsernamePasswordAuthenticationFilter](https://docs.spring.io/spring-security/site/docs/5.3.5.RELEASE/reference/html5/#servlet-authentication-usernamepasswordauthenticationfilter)</code></p>
  <aside>
  ğŸ’¡ åˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯å¦éœ€è¦è®¤è¯
  
  </aside>
  </li>
<li><p>ConcurrentSessionFilter</p>
</li>
<li><p>OpenIDAuthenticationFilter</p>
</li>
<li><p>DefaultLoginPageGeneratingFilter</p>
</li>
<li><p>DefaultLogoutPageGeneratingFilter</p>
</li>
<li><p><code>[DigestAuthenticationFilter](https://docs.spring.io/spring-security/site/docs/5.3.5.RELEASE/reference/html5/#servlet-authentication-digest)</code></p>
</li>
<li><p>BearerTokenAuthenticationFilter</p>
</li>
<li><p><code>[BasicAuthenticationFilter](https://docs.spring.io/spring-security/site/docs/5.3.5.RELEASE/reference/html5/#servlet-authentication-basic)</code></p>
</li>
<li><p>RequestCacheAwareFilter</p>
  <aside>
  ğŸ’¡ é€šå¸¸ç”¨äºå°†åŸæ¥çš„å®¢æˆ·è¯·æ±‚ç¼“å­˜ä¸‹æ¥ï¼Œç„¶åç™»å½•æˆåŠŸåå°†ç¼“å­˜çš„è¯·æ±‚ä»ç¼“å­˜ä¸­æå–å‡ºæ¥ã€‚
  
  </aside>
  </li>
<li><p>SecurityContextHolderAwareRequestFilter</p>
  <aside>
  ğŸ’¡ å¯¹è¯·æ±‚HttpServletRequesté‡‡ç”¨Wrapper/Decoratoræ¨¡å¼åŒ…è£…æˆä¸€ä¸ªå¯ä»¥è®¿é—®SecurityContextHolderä¸­å®‰å…¨ä¸Šä¸‹æ–‡çš„SecurityContextHolderAwareRequestWrapper
  
  </aside>
  </li>
<li><p>JaasApiIntegrationFilter</p>
</li>
<li><p>RememberMeAuthenticationFilter</p>
</li>
<li><p>AnonymousAuthenticationFilter</p>
</li>
<li><p>OAuth2AuthorizationCodeGrantFilter</p>
</li>
<li><p>SessionManagementFilter</p>
  <aside>
  ğŸ’¡ æ£€æµ‹ä»è¯·æ±‚å¤„ç†å¼€å§‹åˆ°ç›®å‰æ˜¯å¦æœ‰ç”¨æˆ·ç™»å½•è®¤è¯ï¼Œå¦‚æœæœ‰åšç›¸åº”çš„ session ç®¡ç†ï¼Œæ¯”å¦‚é’ˆå¯¹ä¸ºæ–°ç™»å½•ç”¨æˆ·åˆ›å»ºæ–°çš„ sessionï¼ˆsession fixationé˜²æŠ¤ï¼‰å’Œè®¾ç½®æ–°çš„ csrf token ç­‰ã€‚
  
  </aside>
  </li>
<li><p><code>[ExceptionTranslationFilter](https://docs.spring.io/spring-security/site/docs/5.3.5.RELEASE/reference/html5/#servlet-exceptiontranslationfilter)</code></p>
  <aside>
  ğŸ’¡ å¤„ç† `AccessDeniedException` å’Œ `AuthenticationException` å¼‚å¸¸ï¼Œå°†å®ƒä»¬è½¬æ¢æˆç›¸åº”çš„ HTTP å“åº”ã€‚
  
  </aside>
  </li>
<li><p><code>[FilterSecurityInterceptor](https://docs.spring.io/spring-security/site/docs/5.3.5.RELEASE/reference/html5/#servlet-authorization-filtersecurityinterceptor)</code></p>
</li>
<li><p>SwitchUserFilter</p>
</li>
</ul>
</li>
</ul>
<h2 id="9-6-Handling-Security-Exceptions"><a href="#9-6-Handling-Security-Exceptions" class="headerlink" title="9.6. Handling Security Exceptions"></a>9.6. Handling Security Exceptions</h2><p><code>ExceptionTranslationFilter</code> å°†ä¼šæŠŠ <code>AccessDeniedException</code> å’Œ <code>AuthenticationException</code> è½¬æ¢æˆ HTTP å“åº”ã€‚</p>
<p><code>ExceptionTranslationFilter</code> ä½œä¸ºä¸€ä¸ª Security Filter æ’å…¥åˆ° FilterChainProxy ä¸­ã€‚</p>
<p><img src="/note-of-spring-security/Untitled%206.png" srcset="/img/loading.gif" lazyload alt="/../image/note-of-spring-security/Untitled%206.png"></p>
<p>å…ƒç´ è¿‡å¤š</p>
<ul>
<li>DelegatingFilterProxy</li>
<li>FilterChainProxyï¼ˆBean Filterï¼‰</li>
<li>SecurityFilterChain</li>
</ul>
<h1 id="10-Authentication-èº«ä»½éªŒè¯"><a href="#10-Authentication-èº«ä»½éªŒè¯" class="headerlink" title="10. Authentication èº«ä»½éªŒè¯"></a>10. Authentication èº«ä»½éªŒè¯</h1><p><strong>Architecture Components</strong>ï¼ˆä½“ç³»ç»“æ„ç»„ä»¶ï¼‰</p>
<ul>
<li><code>SecurityContextHolder</code> - <code>Spring Security</code>å­˜å‚¨èº«ä»½éªŒè¯çš„è¯¦ç»†ä¿¡æ¯çš„åœ°æ–¹</li>
<li><code>SecurityContext</code> - æ¥æºäº <code>SecurityContextHolder</code> ï¼ŒåŒ…å«å½“å‰é€šè¿‡éªŒè¯ç”¨æˆ·çš„èº«ä»½éªŒè¯ä¿¡æ¯</li>
<li><code>Authentication</code> - å¯ä½œä¸º <code>AuthenticationManager</code> çš„è¾“å…¥ï¼Œæä¾›ç”¨æˆ·ç”¨äºèº«ä»½éªŒè¯æˆ–æ˜¯ <code>SecurityContext</code> å½“å‰ç”¨æˆ·çš„å‡­è¯</li>
<li><code>GrantedAuthority</code> - åœ¨ <code>Authentication</code> ä¸­æˆäºˆä¸»ä½“ï¼ˆprincipalï¼‰çš„æƒé™ï¼ˆä¾‹å¦‚è§’è‰²ã€åŸŸ scope ç­‰ï¼‰</li>
<li><code>AuthenticationManager</code> - å®šä¹‰äº† Spring Security æ‰§è¡Œè®¤è¯çš„ API</li>
<li><code>ProviderManager</code> - <code>AuthenticationManager</code> æœ€å¸¸ç”¨çš„å®ç°</li>
<li><code>AuthenticationProvider</code> - <code>ProviderManeager</code> ç”¨äºæ‰§è¡Œç‰¹å®šç±»å‹çš„èº«ä»½éªŒè¯</li>
<li><code>Request Credentials with AuthenticationEntryPoint</code> - å®¢æˆ·ç«¯ç”¨äºè¯·æ±‚å‡­è¯ï¼ˆä¾‹å¦‚é‡å®šå‘åˆ°ç™»å½•é¡µï¼Œå‘é€ <code>WWW-Authenticate</code> å“åº”ç­‰ï¼‰</li>
<li><code>AbstractAuthenticationProcessingFilter</code> - ç”¨äºèº«ä»½éªŒè¯çš„åŸºç¡€ <code>Filter</code> ã€‚ç”±æ­¤èƒ½å¾ˆå¥½åœ°äº†è§£ä¸Šå±‚èº«ä»½éªŒè¯æµç¨‹ä»¥åŠå„ä¸ªéƒ¨ä»¶æ˜¯å¦‚ä½•ä¸€èµ·å·¥ä½œçš„ã€‚</li>
</ul>
<p><strong>Authentication Mechanisms</strong>ï¼ˆèº«ä»½éªŒè¯æœºåˆ¶&#x2F;è®¤è¯æœºåˆ¶ï¼‰</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/5.3.5.RELEASE/reference/html5/#servlet-authentication-unpwd">Username and Password</a>Â - how to authenticate with a username&#x2F;password</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/5.3.5.RELEASE/reference/html5/#oauth2login">OAuth 2.0 Login</a>Â - OAuth 2.0 Log In with OpenID Connect and non-standard OAuth 2.0 Login (i.e. GitHub)</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/5.3.5.RELEASE/reference/html5/#servlet-saml2">SAML 2.0 Login</a>Â - SAML 2.0 Log In</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/5.3.5.RELEASE/reference/html5/#servlet-cas">Central Authentication Server (CAS)</a>Â - Central Authentication Server (CAS) Support</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/5.3.5.RELEASE/reference/html5/#servlet-rememberme">Remember Me</a>Â - How to remember a user past session expiration</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/5.3.5.RELEASE/reference/html5/#servlet-jaas">JAAS Authentication</a>Â - Authenticate with JAAS</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/5.3.5.RELEASE/reference/html5/#servlet-openid">OpenID</a>Â - OpenID Authentication (not to be confused with OpenID Connect)</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/5.3.5.RELEASE/reference/html5/#servlet-preauth">Pre-Authentication Scenarios</a>Â - Authenticate with an external mechanism such asÂ <a target="_blank" rel="noopener" href="https://www.siteminder.com/">SiteMinder</a>Â or Java EE security but still use Spring Security for authorization and protection against common exploits.</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/5.3.5.RELEASE/reference/html5/#servlet-x509">X509 Authentication</a>Â - X509 Authentication</li>
</ul>
<h2 id="10-1-SecurityContextHolder"><a href="#10-1-SecurityContextHolder" class="headerlink" title="10.1. SecurityContextHolder"></a>10.1. SecurityContextHolder</h2><p>ä½œä¸º <code>Spring Security</code> çš„è®¤è¯æ¨¡å‹æ ¸å¿ƒï¼Œå®ƒåŒ…å«äº† <code>SecurityContext</code> ã€‚</p>
<p><img src="/note-of-spring-security/Untitled%207.png" srcset="/img/loading.gif" lazyload alt="/../image/note-of-spring-security/Untitled%207.png"></p>
<p><code>SecurityContextHolder</code>æ˜¯ <code>Spring Security</code> ç”¨æ¥å­˜å‚¨äº†å·²è®¤è¯ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯çš„ç±»ã€‚</p>
<p><strong>è¡¨ç¤ºç”¨æˆ·å·²é€šè¿‡èº«ä»½éªŒè¯æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯</strong> <code>Set</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">SecurityContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> SecurityContextHolder.createEmptyContext();<span class="hljs-comment">// 1 </span><br><span class="hljs-type">Authentication</span> <span class="hljs-variable">authentication</span> <span class="hljs-operator">=</span><br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestingAuthenticationToken</span>(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;password&quot;</span>, <span class="hljs-string">&quot;ROLE_USER&quot;</span>); <span class="hljs-comment">// 2</span><br>context.setAuthentication(authentication);<br><br>SecurityContextHolder.setContext(context); <span class="hljs-comment">// 3</span><br></code></pre></td></tr></table></figure>

<aside>
ğŸ’¡ 1ã€é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„ `SecurityContext` å®ä¾‹ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ `SecurityContextHolder.getContext().setAuthentication(authentication)` ï¼Œä»è€Œé¿å…å¤šçº¿ç¨‹çš„ç«äº‰é—®é¢˜ã€‚
2ã€Spring Security ä¸å…³å¿ƒ `Authentication`çš„å®ç°ã€‚æ›´å¸¸è§çš„æ–¹æ¡ˆæ˜¯ä½¿ç”¨ `UsernamePasswordAuthenticationToken(userDetails, password, authorities)`
3ã€Spring Security å°†ä½¿ç”¨è¿™ä»½ä¿¡æ¯å» authorizationï¼ˆæˆæƒï¼‰

</aside>

<p><strong>è®¿é—®å½“å‰å·²è®¤è¯çš„ç”¨æˆ·ä¿¡æ¯</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">SecurityContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> SecurityContextHolder.getContext();<br><span class="hljs-type">Authentication</span> <span class="hljs-variable">authentication</span> <span class="hljs-operator">=</span> context.getAuthentication();<br><span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> authentication.getName();<br><span class="hljs-type">Object</span> <span class="hljs-variable">principal</span> <span class="hljs-operator">=</span> authentication.getPrincipal();<br>Collection&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">GrantedAuthority</span>&gt; authorities = authentication.getAuthorities();<br></code></pre></td></tr></table></figure>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>SecurityContextHolder</code> ä½¿ç”¨ <code>ThreadLocal</code> å­˜å‚¨ä¿¡æ¯ï¼Œæ„å‘³ç€æ²¡æœ‰æ˜¾å¼ä¼ å‚ç»™æ–¹æ³•ï¼Œä¹Ÿèƒ½åœ¨åŒä¸€çº¿ç¨‹æ–¹æ³•ä¸­ä½¿ç”¨ <code>SecurityContext</code>ã€‚</p>
<p>å¦‚æœåœ¨å½“å‰ä¸»ä½“çš„è¯·æ±‚è¢«å¤„ç†åæ¸…é™¤çº¿ç¨‹ï¼Œé‚£ä¹ˆä»¥è¿™ç§æ–¹å¼ä½¿ç”¨ <code>ThreadLocal</code> æ˜¯éå¸¸å®‰å…¨çš„ã€‚<code>FilterChainProxy</code> ç¡®ä¿ <code>SecurityContext</code> æ€»æ˜¯è¢«æ¸…é™¤ã€‚</p>
<p>æœ‰äº›åº”ç”¨ç¨‹åºå¹¶ä¸å®Œå…¨é€‚åˆä½¿ç”¨ <code>ThreadLocal</code>ï¼Œè¿™æ˜¯å› ä¸ºå®ƒä»¬ä½¿ç”¨çº¿ç¨‹çš„ç‰¹å®šæ–¹å¼ã€‚å¯ä»¥æ ¹æ®å…·ä½“çš„åœºæ™¯ä½¿ç”¨ <code>SecurityContextHolder</code> ä¸åŒçš„ç­–ç•¥ã€‚</p>
<h2 id="10-2-SecurityContext"><a href="#10-2-SecurityContext" class="headerlink" title="10.2 SecurityContext"></a>10.2 SecurityContext</h2><p> ä» <code>SecurityContextHolder</code> å¯ä»¥è·å¾— <code>SecurityContext</code>ï¼ŒåŒ…å«äº† <code>Authentication</code> å¯¹è±¡ã€‚</p>
<h2 id="10-3-Authentication"><a href="#10-3-Authentication" class="headerlink" title="10.3. Authentication"></a>10.3. Authentication</h2><p><code>Authentication</code> ä¸»è¦ç”¨äºä¸¤ä¸ªæ„å›¾ï¼š</p>
<ul>
<li>æä¾›è®¤è¯ï¼š <code>AuthenticationManager</code> çš„è¾“å…¥ï¼Œç”¨äºæä¾›ç”¨æˆ·èº«ä»½éªŒè¯çš„å‡­æ®ã€‚è¿™ç§æƒ…å†µï¼Œ<code>isAuthenticated()</code> è¿”å› <code>false</code>ã€‚</li>
<li>è®¤è¯æˆåŠŸï¼šè¡¨ç¤ºå½“å‰ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ï¼Œ<code>isAuthenticated()</code> è¿”å› <code>true</code>ã€‚å½“å‰çš„<code>Authentication</code> å¯ä»¥ä» <code>SecurityContext</code> è·å¾—ã€‚</li>
</ul>
<p><code>Authentication</code> åŒ…å«ï¼š</p>
<ul>
<li><code>principal</code>Â - æ ‡è¯†ç”¨æˆ·ã€‚é€šè¿‡ username&#x2F;password è®¤è¯çš„é€šå¸¸æ˜¯ <code>UserDetails</code> çš„å®ä¾‹ã€‚</li>
<li><code>credentials</code>Â - å¯†ç ã€‚é€šå¸¸ç¡®ä¿åœ¨ç”¨æˆ·ç™»å½•åæ¸…é™¤ï¼Œé¿å…æ³„éœ²ã€‚</li>
<li><code>authorities</code>Â - ç”¨æˆ·è¢«æˆäºˆçš„ä¸Šå±‚æƒé™ï¼ˆtheÂ <code>[GrantedAuthority</code>s](<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-security/site/docs/5.3.5.RELEASE/reference/html5/#servlet-authentication-granted-authority">https://docs.spring.io/spring-security/site/docs/5.3.5.RELEASE/reference/html5/#servlet-authentication-granted-authority</a>)Â are high level permissions the user is granted.ï¼‰ A few examples are roles or scopes.</li>
</ul>
<h2 id="10-4-GrantedAuthorityï¼ˆæƒé™ï¼‰"><a href="#10-4-GrantedAuthorityï¼ˆæƒé™ï¼‰" class="headerlink" title="10.4. GrantedAuthorityï¼ˆæƒé™ï¼‰"></a>10.4. GrantedAuthorityï¼ˆæƒé™ï¼‰</h2><p>è§’è‰²ã€ä½œç”¨åŸŸã€‚</p>
<p><code>GrantedAuthority</code>s å¯ä»¥é€šè¿‡ <code>Authentication.getAuthorities()</code> æ–¹æ³•æ¥è·å¾—ã€‚æ–¹æ³•è¿”å› <code>GrantedAuthority</code> å¯¹è±¡çš„é›†åˆã€‚<code>GrantedAuthority</code> å°±æ˜¯æˆäºˆä¸»ä½“çš„æƒé™ã€‚è¿™äº›æƒé™é€šå¸¸å°±æ˜¯ â€œrolesâ€ï¼Œä¾‹å¦‚ <code>ROLE_ADMINISTRATOR</code> æˆ– <code>ROLE_HR_SUPERVISOR</code> ã€‚è¿™äº›è§’è‰²åç»­é…ç½®ç”¨äº web æˆæƒï¼Œæ–¹æ³•æˆæƒå’ŒåŸŸå¯¹è±¡æˆæƒã€‚Other parts of Spring Security are capable of interpreting these authorities, and expect them to be present. When using username&#x2F;password based authentication GrantedAuthoritys are usually loaded by the UserDetailsService.</p>
<p>Usually the GrantedAuthority objects are application-wide permissions. They are not specific to a given domain object. Thus, you wouldnâ€™t likely have a GrantedAuthority to represent a permission to Employee object number 54, because if there are thousands of such authorities you would quickly run out of memory (or, at the very least, cause the application to take a long time to authenticate a user). Of course, Spring Security is expressly designed to handle this common requirement, but youâ€™d instead use the projectâ€™s domain object security capabilities for this purpose.</p>
<h2 id="10-5-AuthenticationManager"><a href="#10-5-AuthenticationManager" class="headerlink" title="10.5. AuthenticationManager"></a>10.5. AuthenticationManager</h2><p><code>AuthenticationManager</code> æ˜¯å®šä¹‰ Spring Security è¿‡æ»¤å™¨å¦‚ä½•æ‰§è¡Œèº«ä»½éªŒè¯çš„ APIã€‚ç”±è°ƒç”¨ <code>AuthenticationManager</code> çš„æ§åˆ¶å™¨ï¼ˆå³ Spring Security Filtersï¼‰åœ¨ <code>SecurityContextHolder</code> ä¸Šè®¾ç½®è¿”å›çš„èº«ä»½éªŒè¯ã€‚å¦‚æœæ²¡æœ‰é›†æˆ Spring Security çš„è¿‡æ»¤å™¨ï¼Œå¯ä»¥ç›´æ¥è®¾ç½® <code>SecurityContextHolder</code>  è€Œä¸éœ€è¦ä½¿ç”¨ <code>AuthenticationManager</code> ã€‚</p>
<h2 id="10-6-ProviderManager"><a href="#10-6-ProviderManager" class="headerlink" title="10.6. ProviderManager"></a>10.6. ProviderManager</h2><p><code>ProviderManager</code> æ˜¯ <code>AuthenticationManager</code> æœ€å¸¸è§çš„å®ç°ã€‚<code>ProviderManager</code> ä»£ç†äº†ä¸€ä¸ª AuthenticationProviders çš„åˆ—è¡¨ï¼ˆListï¼‰. æ¯ä¸€ä¸ª <code>AuthenticationProvider</code> éƒ½æœ‰æœºä¼šå»æŒ‡å‡ºèº«ä»½éªŒè¯ä¸ºæˆåŠŸï¼Œå¤±è´¥æˆ–è€…ä¸èƒ½åšå‡ºåˆ¤æ–­å¹¶å…è®¸ä¸‹æ¸¸çš„ AuthenticationProvider å»å†³ç­–ã€‚å¦‚æœé…ç½®çš„ AuthenticationProviders éƒ½ä¸èƒ½å¤ŸéªŒè¯èº«ä»½ï¼Œé‚£ä¹ˆèº«ä»½éªŒè¯ä¼šä¼´éš ProviderNotFoundException å¼‚å¸¸å¤±è´¥ï¼Œä»£è¡¨æ‰¾ä¸åˆ°è¯¥ Authentication èº«ä»½éªŒè¯çš„ç›¸å…³æ”¯æŒã€‚</p>
<p><img src="/note-of-spring-security/Untitled%208.png" srcset="/img/loading.gif" lazyload alt="/../image/note-of-spring-security/Untitled%208.png"></p>
<p>äº‹å®ä¸Šæ¯ä¸ª <code>AuthenticationProvider</code> éƒ½å¯ä»¥æ‰§è¡Œç‰¹å®šæ–¹å¼çš„è®¤è¯ã€‚ä¾‹å¦‚ï¼Œå…¶ä¸­ä¸€ä¸ª <code>AuthenticationProvider</code> èƒ½å¤ŸéªŒè¯ è´¦å·&#x2F;å¯†ç ï¼Œå¦ä¸€ä¸ªèƒ½å¤Ÿé€šè¿‡ SAML çš„æ–¹å¼è¿›è¡ŒéªŒè¯ã€‚è¿™å°±æ”¯æŒåªæš´éœ²ä¸€ä¸ª <code>AuthenticationManager</code> bean å°±èƒ½å¤Ÿæ”¯æŒå¤šç§æ–¹å¼çš„èº«ä»½éªŒè¯ã€‚</p>
<p><code>ProviderManager</code> ä¹Ÿå¯ä»¥é…ç½®ä¸€ä¸ªï¼ˆå¯é€‰çš„ï¼‰çˆ¶çº§ <code>AuthenticationManager</code> ï¼Œç”¨äºæ²¡æœ‰ <code>AuthenticationProvider</code> èƒ½å¤Ÿæ‰§è¡Œèº«ä»½éªŒè¯æ—¶è¿›è¡Œå†³ç­–ã€‚è¿™ä¸ªçˆ¶çº§é€šå¸¸æ˜¯ä¸€ä¸ª <code>ProviderManager</code> å®ç°ã€‚</p>
<p><img src="/note-of-spring-security/Untitled%209.png" srcset="/img/loading.gif" lazyload alt="/../image/note-of-spring-security/Untitled%209.png"></p>
<p>é€šå¸¸ï¼Œå¤šä¸ª <code>ProviderManager</code> å¯ä»¥å…±äº«åŒä¸€ä¸ªçˆ¶çº§ <code>AuthenticationManager</code> ã€‚è¿™ç§å®è·µæ–¹å¼å¸¸è§äºå¤šä¸ª <code>SecurityFilterChain</code> æœ‰éƒ¨åˆ†å…¬å…±çš„èº«ä»½è®¤è¯ï¼ˆå…±äº«çš„çˆ¶çº§ <code>AuthenticationManager</code>ï¼‰ï¼Œä¹Ÿæœ‰éƒ¨åˆ†ä¸åŒçš„èº«ä»½éªŒè¯æœºåˆ¶ï¼ˆä¸åŒçš„ <code>ProviderManager</code> å®ä¾‹ï¼‰ã€‚</p>
<p><img src="/note-of-spring-security/Untitled%2010.png" srcset="/img/loading.gif" lazyload alt="/../image/note-of-spring-security/Untitled%2010.png"></p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>ProviderManager</code> ä¼šå°è¯•å»æ¸…é™¤ç”±æˆåŠŸè®¤è¯è¯·æ±‚è¿”å›çš„ <code>Authentication</code> å¯¹è±¡ç§çš„æ•æ„Ÿå‡­è¯ä¿¡æ¯ã€‚è¿™å¯ä»¥é˜²æ­¢è¯¸å¦‚å¯†ç ä¹‹ç±»çš„ä¿¡æ¯åœ¨ <code>HttpSession</code> ä¸­é•¿æ—¶é—´ä¿ç•™ã€‚</p>
<p>åœ¨ä½¿ç”¨ç”¨æˆ·å¯¹è±¡ç¼“å­˜æ—¶ï¼ˆä¾‹å¦‚ï¼Œåœ¨æ— çŠ¶æ€åº”ç”¨ä¸­æå‡æ€§èƒ½ï¼‰ï¼Œå¯èƒ½æœ‰æ½œåœ¨çš„é—®é¢˜ã€‚å¦‚æœ <code>Authentication</code> åœ¨ç¼“å­˜ä¸­åŒ…å«äº†å¯¹è±¡ï¼ˆä¾‹å¦‚ <code>UserDetails</code> å®ä¾‹ï¼‰çš„å¼•ç”¨ï¼Œè€Œå®ƒçš„å‡­è¯è¢«ç§»é™¤ï¼Œè¿™å°†ä¼šå¯¼è‡´ä¸å†èƒ½å¤Ÿé€šè¿‡ç¼“å­˜çš„å€¼è¿›è¡Œèº«ä»½éªŒè¯ã€‚å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ç¼“å­˜ï¼Œå¿…é¡»è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ã€‚ä¸€ä¸ªå¸¸è§çš„è§£å†³æ–¹æ¡ˆæ˜¯å…ˆå¤åˆ¶å¯¹è±¡ï¼Œè¦ä¹ˆåœ¨ç¼“å­˜ä¸­å®ç°ï¼Œè¦ä¹ˆåœ¨åˆ›å»ºè¿”å› <code>Authentication</code> å¯¹è±¡çš„ <code>AuthenticationProvider</code> ä¸­å®ç°ã€‚å¦å¤–ï¼Œå¯ä»¥è€ƒè™‘ç¦æ­¢ ProviderManger  çš„<code>eraseCredentialsAfterAuthentication</code> å­—æ®µã€‚</p>
<h2 id="10-7-AuthenticationProvider"><a href="#10-7-AuthenticationProvider" class="headerlink" title="10.7. AuthenticationProvider"></a>10.7. AuthenticationProvider</h2><p>å¯ä»¥æ³¨å…¥å¤šç§ <code>AuthenticationProvider</code> s åˆ° <code>ProviderManager</code> ä¸­ã€‚æ¯ä¸ª <code>AuthenticationProvider</code> éƒ½æ‰§è¡Œç‰¹å®šæ–¹å¼çš„è®¤è¯è¿‡ç¨‹ã€‚ä¾‹å¦‚ <code>DaoAuthenticationProvider</code> æ”¯æŒåŸºäºç”¨æˆ·å&#x2F;å¯†ç çš„è®¤è¯ï¼Œè€Œ <code>JwtAuthenticationProvider</code> æ”¯æŒ JWT token éªŒè¯ã€‚</p>
<h2 id="10-8-Request-Credentials-with-AuthenticationEntryPoint"><a href="#10-8-Request-Credentials-with-AuthenticationEntryPoint" class="headerlink" title="10.8. Request Credentials with AuthenticationEntryPoint"></a>10.8. Request Credentials with <code>AuthenticationEntryPoint</code></h2><p><code>AuthenticationEntryPoint</code> æ˜¯å®¢æˆ·ç«¯ç”¨äºè¯·æ±‚å‡­è¯å‘é€çš„ HTTP ç›¸åº”ã€‚ </p>
<p>æœ‰äº›æ—¶å€™å®¢æˆ·ç«¯ä¼šæºå¸¦å‡­è¯ï¼ˆä¾‹å¦‚è´¦å·&#x2F;å¯†ç ï¼‰å»è¯·æ±‚èµ„æºã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼ŒSpring Securityä¸éœ€è¦æä¾›ä»å®¢æˆ·ç«¯è¯·æ±‚å‡­æ®çš„HTTPå“åº”ï¼Œå› ä¸ºå®ƒä»¬å·²ç»åŒ…å«åœ¨å†…äº†ã€‚</p>
<p>å…¶å®ƒæƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯ä¼šå‘ä»–ä»¬æ²¡æœ‰æƒé™è®¿é—®çš„èµ„æºå‘å‡ºæœªç»èº«ä»½éªŒè¯çš„è¯·æ±‚ã€‚<code>AuthenticationEntryPoint</code> çš„å®ç°ç”¨äºå®¢æˆ·ç«¯è¯·æ±‚å‡­è¯ã€‚å…¶å®ç°å¯èƒ½ä¼šæ‰§è¡Œé‡å®šå‘åˆ°ç™»å½•é¡µï¼Œè¿”å› WWW-Authenticate å“åº”å¤´ï¼Œç­‰ç­‰ã€‚</p>
<h2 id="10-9-AbstractAuthenticationProcessingFilter"><a href="#10-9-AbstractAuthenticationProcessingFilter" class="headerlink" title="10.9. AbstractAuthenticationProcessingFilter"></a>10.9. AbstractAuthenticationProcessingFilter</h2><p><code>AbstractAuthenticationProcessingFilter</code> æ˜¯ç”¨äºè®¤è¯ç”¨æˆ·å‡­è¯çš„åŸºç¡€ <code>Filter</code> ã€‚åœ¨å‡­è¯è¢«éªŒè¯ä¹‹å‰ï¼ŒSpring Security é€šå¸¸ä¼šä½¿ç”¨ <code>AuthenticationEntryPoint</code> æ¥è¯·æ±‚å‡­è¯ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œ<code>AbstractAuthenticationProcessingFilter</code> å¯ä»¥éªŒè¯æäº¤çš„ä»»ä½•èº«ä»½éªŒè¯è¯·æ±‚ã€‚</p>
<p><img src="/note-of-spring-security/Untitled%2011.png" srcset="/img/loading.gif" lazyload alt="/../image/note-of-spring-security/Untitled%2011.png"></p>
<ol>
<li>å½“ç”¨æˆ·æäº¤ä»–ä»¬çš„å‡­è¯ï¼Œ<code>AbstractAuthenticationProcessingFilter</code> ä¼šä» <code>HttpServletRequest</code> åˆ›å»ºä¸€ä¸ª <code>Authentication</code> å»åšèº«ä»½éªŒè¯ã€‚<code>Authentication</code> çš„ç±»å‹å–å†³äº <code>AbstractAuthenticationProcessingFilter</code> çš„å­ç±»ã€‚ä¾‹å¦‚ï¼Œ<code>UsernamePasswordAuthenticationFilter</code> ä» <code>HttpServletRequest</code> æäº¤çš„ username å’Œ password åˆ›å»ºä¸€ä¸ª <code>UsernamePasswordAuthenticationToken</code> ï¼ˆ<code>Authentication</code> çš„ä¸€ç§å®ç°ï¼‰ã€‚</li>
<li>æ¥ç€ï¼Œ<code>Authentication</code> ä¼ é€’åˆ° <code>AuthenticationManager</code> åšèº«ä»½éªŒè¯ã€‚</li>
<li>å¦‚æœèº«ä»½éªŒè¯å¤±è´¥ï¼Œåˆ™<ul>
<li>æ¸…ç©º <code>SecurityContextHolder</code></li>
<li>è°ƒç”¨ <code>RememberMeServices.loginFail</code> ã€‚å¦‚æœæ²¡æœ‰é…ç½® remember meï¼Œåˆ™æ— æ“ä½œã€‚</li>
<li>è°ƒç”¨ <code>AuthenticationFailureHandler</code></li>
</ul>
</li>
<li>å¦‚æœèº«ä»½éªŒè¯æˆåŠŸï¼Œåˆ™<ul>
<li><code>SessionAuthenticationStrategy</code> æ”¶åˆ°æ–°çš„ç™»å½•é€šçŸ¥</li>
<li><code>Authentication</code> è¢« set åˆ° <code>SecurityContextHolder</code> ã€‚åç»­<code>SecurityContextPersistenceFilter</code> ä¼šå°† <code>SecurityContext</code> ä¿å­˜åˆ° <code>HttpSession</code> ã€‚</li>
<li>è°ƒç”¨ <code>RememberMeServices.loginSuccess</code> ã€‚å¦‚æœæ²¡æœ‰é…ç½® remember meï¼Œåˆ™æ— æ“ä½œã€‚</li>
<li><code>ApplicationEventPublisher</code> å‘å¸ƒ <code>InteractiveAuthenticationSuccessEvent</code> ã€‚</li>
</ul>
</li>
</ol>
<h2 id="10-17-CAS-Authentication"><a href="#10-17-CAS-Authentication" class="headerlink" title="10.17. CAS Authentication"></a>10.17. CAS Authentication</h2><h1 id="11-Authorization"><a href="#11-Authorization" class="headerlink" title="11. Authorization"></a>11. Authorization</h1><h2 id="11-1-Authorization-Architecture"><a href="#11-1-Authorization-Architecture" class="headerlink" title="11.1 Authorization Architecture"></a>11.1 Authorization Architecture</h2><p>åœ¨æœ¬éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢åœ¨ç¬¬1éƒ¨åˆ†ä¸­ä»‹ç»çš„ä¸åŒçš„ <code>AbstractSecurityInterceptor</code> å®ç°ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†ç»§ç»­æ¢ç´¢å¦‚ä½•é€šè¿‡ä½¿ç”¨åŸŸè®¿é—®æ§åˆ¶åˆ—è¡¨æ¥è°ƒä¼˜æˆæƒã€‚</p>
<h3 id="11-1-1-Authorities"><a href="#11-1-1-Authorities" class="headerlink" title="11.1.1. Authorities"></a>11.1.1. Authorities</h3><p>èº«ä»½éªŒè¯ï¼Œè®¨è®ºæ‰€æœ‰èº«ä»½éªŒè¯å®ç°å¦‚ä½•å­˜å‚¨æˆäºˆæƒé™å¯¹è±¡çš„åˆ—è¡¨ã€‚</p>
<p>è¿™äº›ä»£è¡¨äº†è¢«æˆäºˆç»™ç”¨æˆ·æƒé™ã€‚ <code>AuthenticationManager</code> æ’å…¥<code>GrantedAuthority</code> å¯¹è±¡åˆ° <code>Authentication</code> ä¸­ï¼Œä¹‹åæˆæƒå†³ç­–æ—¶ç”± <code>AccessDecisionManager</code>è¯»å–ã€‚</p>
<p><code>GrantedAuthority</code> æ˜¯åªæœ‰ä¸€ä¸ªæ–¹æ³•çš„æ¥å£ï¼Œè¡¨ç¤ºå·²è®¤è¯å¯¹è±¡è¢«æˆäºˆçš„æƒé™ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">String <span class="hljs-title function_">getAuthority</span><span class="hljs-params">()</span>;<br></code></pre></td></tr></table></figure>

<p>ä¸€èˆ¬ç”± AccessDecisionManager è·å–æƒé™çš„ String å½¢å¼ï¼Œæ¥åšæœ€ç»ˆçš„è®¿é—®æ§åˆ¶å†³ç­–ã€‚</p>
<p>å¦‚æœ String ä¸èƒ½å¾ˆå¥½çš„è¡¨ç¤ºï¼Œåº”è¯¥è¢«è®¤å®šä¸ºâ€œå¤æ‚â€æƒé™ï¼Œå¹¶ä¸”è¯¥æ¥å£è¿”å› nullã€‚ï¼ˆä¾‹å¦‚å­˜å‚¨åº”ç”¨äºä¸åŒå®¢æˆ·è´¦å·çš„æ“ä½œåˆ—è¡¨å’Œæƒé™é˜ˆå€¼çš„å®ç°ã€‚å°†è¿™ä¸ªå¤æ‚çš„æˆæƒè¡¨ç¤ºä¸ºå­—ç¬¦ä¸²å°†éå¸¸å›°éš¾ï¼‰</p>
<p>è¿”å› <code>null</code> ä¼šè®© <code>AccessDecisionManager</code> ç‰¹åˆ«æ”¯æŒ <code>GrantedAuthority</code> å®ç°æ¥è¯†åˆ«æƒé™åˆ—è¡¨ã€‚</p>
<p>Spring Security åŒ…æ‹¬ä¸€ä¸ªå…·ä½“çš„ <code>GrantedAuthority</code> å®ç°ï¼Œ<code>SimpleGrantedAuthority</code>ã€‚å®ƒå°†ä»»ä½•ç”¨æˆ·æŒ‡å®šçš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºå·²æˆäºˆçš„æƒé™ã€‚å®‰å…¨ä½“ç³»ç»“æ„ä¸­åŒ…å«çš„æ‰€æœ‰ <code>AuthenticationProvider</code>éƒ½ä½¿ç”¨<code>SimpleGrantedAuthority</code> æ¥å¡«å……èº«ä»½éªŒè¯å¯¹è±¡ã€‚</p>
<h3 id="11-1-2-Pre-Invocation-Handlingï¼ˆè°ƒç”¨å‰å¤„ç†ï¼‰"><a href="#11-1-2-Pre-Invocation-Handlingï¼ˆè°ƒç”¨å‰å¤„ç†ï¼‰" class="headerlink" title="11.1.2. Pre-Invocation Handlingï¼ˆè°ƒç”¨å‰å¤„ç†ï¼‰"></a>11.1.2. Pre-Invocation Handlingï¼ˆè°ƒç”¨å‰å¤„ç†ï¼‰</h3><p>Spring Security æä¾›äº†ç”¨äºæ§åˆ¶å¯¹å®‰å…¨å¯¹è±¡ï¼ˆå¦‚æ–¹æ³•è°ƒç”¨æˆ–webè¯·æ±‚ï¼‰è®¿é—®æ‹¦æˆªå™¨ã€‚</p>
<p><code>AccessDecisionManager</code> å¯¹æ˜¯å¦å…è®¸è¿›è¡Œè°ƒç”¨åšå‡ºè°ƒç”¨å‰å†³ç­–ã€‚</p>
<ul>
<li><strong>The AccessDecisionManager</strong></li>
</ul>
<p><code>AccessDecisionManager</code> ç”± <code>AbstractSecurityInterceptor</code> è°ƒç”¨ï¼Œè´Ÿè´£åšå‡ºæœ€ç»ˆçš„è®¿é—®æ§åˆ¶å†³ç­–ã€‚</p>
<p><code>AccessDecisionManager</code> æ¥å£åŒ…å« 3 ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">decide</span><span class="hljs-params">(Authentication authentication, Object secureObject,</span><br><span class="hljs-params">    Collection&lt;ConfigAttribute&gt; attrs)</span> <span class="hljs-keyword">throws</span> AccessDeniedException;<br><br><span class="hljs-type">boolean</span> <span class="hljs-title function_">supports</span><span class="hljs-params">(ConfigAttribute attribute)</span>;<br><br><span class="hljs-type">boolean</span> <span class="hljs-title function_">supports</span><span class="hljs-params">(Class clazz)</span>;<br></code></pre></td></tr></table></figure>

<p><code>AccessDecisionManager</code> çš„ <code>decision</code> æ–¹æ³•ä¼ é€’äº†å®ƒåšå‡ºæˆæƒå†³ç­–æ‰€éœ€çš„æ‰€æœ‰ç›¸å…³ä¿¡æ¯ã€‚ç‰¹åˆ«æ˜¯ï¼Œé€šè¿‡ä¼ é€’å®‰å…¨å¯¹è±¡ï¼Œå¯ä»¥æ£€æŸ¥å®é™…å®‰å…¨å¯¹è±¡è°ƒç”¨ä¸­åŒ…å«çš„å‚æ•°ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å‡è®¾å®‰å…¨å¯¹è±¡æ˜¯ä¸€ä¸ªæ–¹æ³•è°ƒç”¨ã€‚</p>
<p>å¦‚æœè®¿é—®è¢«æ‹’ç»ï¼Œå®ç°å°†æŠ›å‡ºAccessDeniedExceptionå¼‚å¸¸ã€‚</p>
<ul>
<li><p><strong>Voting-Based AccessDecisionManager Implementationsï¼ˆåŸºäºæŠ•ç¥¨çš„å®ç°ï¼‰</strong></p>
<p>  <img src="/note-of-spring-security/Untitled%2012.png" srcset="/img/loading.gif" lazyload alt="Voting Decision Manager"></p>
<p>  Voting Decision Manager</p>
</li>
</ul>
<h2 id="11-2-Authorize-HttpServletRequest-with-FilterSecurityInterceptor"><a href="#11-2-Authorize-HttpServletRequest-with-FilterSecurityInterceptor" class="headerlink" title="11.2. Authorize HttpServletRequest with FilterSecurityInterceptor"></a>11.2. Authorize HttpServletRequest with FilterSecurityInterceptor</h2><h2 id="11-3-Expression-Based-Access-Controlï¼ˆåŸºäºè¡¨è¾¾å¼çš„è®¿é—®æ§åˆ¶ï¼‰"><a href="#11-3-Expression-Based-Access-Controlï¼ˆåŸºäºè¡¨è¾¾å¼çš„è®¿é—®æ§åˆ¶ï¼‰" class="headerlink" title="11.3. Expression-Based Access Controlï¼ˆåŸºäºè¡¨è¾¾å¼çš„è®¿é—®æ§åˆ¶ï¼‰"></a>11.3. Expression-Based Access Controlï¼ˆåŸºäºè¡¨è¾¾å¼çš„è®¿é—®æ§åˆ¶ï¼‰</h2><h2 id="11-4-Secure-Object-Implementations"><a href="#11-4-Secure-Object-Implementations" class="headerlink" title="11.4. Secure Object Implementations"></a>11.4. Secure Object Implementations</h2><h2 id="11-5-Method-Security"><a href="#11-5-Method-Security" class="headerlink" title="11.5. Method Security"></a>11.5. Method Security</h2><h2 id="11-6-Domain-Object-Securityï¼ˆACLsï¼‰"><a href="#11-6-Domain-Object-Securityï¼ˆACLsï¼‰" class="headerlink" title="11.6. Domain Object Securityï¼ˆACLsï¼‰"></a>11.6. Domain Object Securityï¼ˆACLsï¼‰</h2>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Spring/" class="category-chain-item">Spring</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Spring/">#Spring</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Spring Security ç¬”è®°</div>
      <div>https://quan7u.github.io/note-of-spring-security</div>
    </div>
    <div class="license-meta">
      
      
        <div class="license-meta-item license-meta-date">
          <div>å‘å¸ƒäº</div>
          <div>2020å¹´10æœˆ14æ—¥</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>è®¸å¯åè®®</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - ç½²å">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/note-of-websocket" title="WebSocketç¬”è®°">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">WebSocketç¬”è®°</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'quan7u/quan7u.github.io');
      s.setAttribute('issue-term', 'url');
      
      s.setAttribute('label', 'utterances');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        æ€»è®¿é—®é‡ 
        <span id="busuanzi_value_site_pv"></span>
         æ¬¡
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        æ€»è®¿å®¢æ•° 
        <span id="busuanzi_value_site_uv"></span>
         äºº
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
